{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/core/node_modules/json-schema-traverse/index.js"],"sourcesContent":["'use strict';\n\nvar traverse = module.exports = function (schema, opts, cb) {\n  // Legacy support for v0.3.1 and earlier.\n  if (typeof opts == 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  cb = opts.cb || cb;\n  var pre = (typeof cb == 'function') ? cb : cb.pre || function() {};\n  var post = cb.post || function() {};\n\n  _traverse(opts, pre, post, schema, '', schema);\n};\n\n\ntraverse.keywords = {\n  additionalItems: true,\n  items: true,\n  contains: true,\n  additionalProperties: true,\n  propertyNames: true,\n  not: true,\n  if: true,\n  then: true,\n  else: true\n};\n\ntraverse.arrayKeywords = {\n  items: true,\n  allOf: true,\n  anyOf: true,\n  oneOf: true\n};\n\ntraverse.propsKeywords = {\n  $defs: true,\n  definitions: true,\n  properties: true,\n  patternProperties: true,\n  dependencies: true\n};\n\ntraverse.skipKeywords = {\n  default: true,\n  enum: true,\n  const: true,\n  required: true,\n  maximum: true,\n  minimum: true,\n  exclusiveMaximum: true,\n  exclusiveMinimum: true,\n  multipleOf: true,\n  maxLength: true,\n  minLength: true,\n  pattern: true,\n  format: true,\n  maxItems: true,\n  minItems: true,\n  uniqueItems: true,\n  maxProperties: true,\n  minProperties: true\n};\n\n\nfunction _traverse(opts, pre, post, schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex) {\n  if (schema && typeof schema == 'object' && !Array.isArray(schema)) {\n    pre(schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex);\n    for (var key in schema) {\n      var sch = schema[key];\n      if (Array.isArray(sch)) {\n        if (key in traverse.arrayKeywords) {\n          for (var i=0; i<sch.length; i++)\n            _traverse(opts, pre, post, sch[i], jsonPtr + '/' + key + '/' + i, rootSchema, jsonPtr, key, schema, i);\n        }\n      } else if (key in traverse.propsKeywords) {\n        if (sch && typeof sch == 'object') {\n          for (var prop in sch)\n            _traverse(opts, pre, post, sch[prop], jsonPtr + '/' + key + '/' + escapeJsonPtr(prop), rootSchema, jsonPtr, key, schema, prop);\n        }\n      } else if (key in traverse.keywords || (opts.allKeys && !(key in traverse.skipKeywords))) {\n        _traverse(opts, pre, post, sch, jsonPtr + '/' + key, rootSchema, jsonPtr, key, schema);\n      }\n    }\n    post(schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex);\n  }\n}\n\n\nfunction escapeJsonPtr(str) {\n  return str.replace(/~/g, '~0').replace(/\\//g, '~1');\n}\n"],"names":[],"mappings":"AAAA;AAEA,IAAI,WAAW,OAAO,OAAO,GAAG,SAAU,MAAM,EAAE,IAAI,EAAE,EAAE;IACxD,yCAAyC;IACzC,IAAI,OAAO,QAAQ,YAAY;QAC7B,KAAK;QACL,OAAO,CAAC;IACV;IAEA,KAAK,KAAK,EAAE,IAAI;IAChB,IAAI,MAAM,AAAC,OAAO,MAAM,aAAc,KAAK,GAAG,GAAG,IAAI,YAAY;IACjE,IAAI,OAAO,GAAG,IAAI,IAAI,YAAY;IAElC,UAAU,MAAM,KAAK,MAAM,QAAQ,IAAI;AACzC;AAGA,SAAS,QAAQ,GAAG;IAClB,iBAAiB;IACjB,OAAO;IACP,UAAU;IACV,sBAAsB;IACtB,eAAe;IACf,KAAK;IACL,IAAI;IACJ,MAAM;IACN,MAAM;AACR;AAEA,SAAS,aAAa,GAAG;IACvB,OAAO;IACP,OAAO;IACP,OAAO;IACP,OAAO;AACT;AAEA,SAAS,aAAa,GAAG;IACvB,OAAO;IACP,aAAa;IACb,YAAY;IACZ,mBAAmB;IACnB,cAAc;AAChB;AAEA,SAAS,YAAY,GAAG;IACtB,SAAS;IACT,MAAM;IACN,OAAO;IACP,UAAU;IACV,SAAS;IACT,SAAS;IACT,kBAAkB;IAClB,kBAAkB;IAClB,YAAY;IACZ,WAAW;IACX,WAAW;IACX,SAAS;IACT,QAAQ;IACR,UAAU;IACV,UAAU;IACV,aAAa;IACb,eAAe;IACf,eAAe;AACjB;AAGA,SAAS,UAAU,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,aAAa,EAAE,aAAa,EAAE,YAAY,EAAE,QAAQ;IACnH,IAAI,UAAU,OAAO,UAAU,YAAY,CAAC,MAAM,OAAO,CAAC,SAAS;QACjE,IAAI,QAAQ,SAAS,YAAY,eAAe,eAAe,cAAc;QAC7E,IAAK,IAAI,OAAO,OAAQ;YACtB,IAAI,MAAM,MAAM,CAAC,IAAI;YACrB,IAAI,MAAM,OAAO,CAAC,MAAM;gBACtB,IAAI,OAAO,SAAS,aAAa,EAAE;oBACjC,IAAK,IAAI,IAAE,GAAG,IAAE,IAAI,MAAM,EAAE,IAC1B,UAAU,MAAM,KAAK,MAAM,GAAG,CAAC,EAAE,EAAE,UAAU,MAAM,MAAM,MAAM,GAAG,YAAY,SAAS,KAAK,QAAQ;gBACxG;YACF,OAAO,IAAI,OAAO,SAAS,aAAa,EAAE;gBACxC,IAAI,OAAO,OAAO,OAAO,UAAU;oBACjC,IAAK,IAAI,QAAQ,IACf,UAAU,MAAM,KAAK,MAAM,GAAG,CAAC,KAAK,EAAE,UAAU,MAAM,MAAM,MAAM,cAAc,OAAO,YAAY,SAAS,KAAK,QAAQ;gBAC7H;YACF,OAAO,IAAI,OAAO,SAAS,QAAQ,IAAK,KAAK,OAAO,IAAI,CAAC,CAAC,OAAO,SAAS,YAAY,GAAI;gBACxF,UAAU,MAAM,KAAK,MAAM,KAAK,UAAU,MAAM,KAAK,YAAY,SAAS,KAAK;YACjF;QACF;QACA,KAAK,QAAQ,SAAS,YAAY,eAAe,eAAe,cAAc;IAChF;AACF;AAGA,SAAS,cAAc,GAAG;IACxB,OAAO,IAAI,OAAO,CAAC,MAAM,MAAM,OAAO,CAAC,OAAO;AAChD","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/ai/node_modules/json5/dist/index.mjs"],"sourcesContent":["// This is a generated file. Do not edit.\nvar Space_Separator = /[\\u1680\\u2000-\\u200A\\u202F\\u205F\\u3000]/;\nvar ID_Start = /[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08BD\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312E\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FEA\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD40-\\uDD74\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDF00-\\uDF1F\\uDF2D-\\uDF4A\\uDF50-\\uDF75\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC60-\\uDC76\\uDC80-\\uDC9E\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDD00-\\uDD15\\uDD20-\\uDD39\\uDD80-\\uDDB7\\uDDBE\\uDDBF\\uDE00\\uDE10-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE33\\uDE60-\\uDE7C\\uDE80-\\uDE9C\\uDEC0-\\uDEC7\\uDEC9-\\uDEE4\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF60-\\uDF72\\uDF80-\\uDF91]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2]|\\uD804[\\uDC03-\\uDC37\\uDC83-\\uDCAF\\uDCD0-\\uDCE8\\uDD03-\\uDD26\\uDD50-\\uDD72\\uDD76\\uDD83-\\uDDB2\\uDDC1-\\uDDC4\\uDDDA\\uDDDC\\uDE00-\\uDE11\\uDE13-\\uDE2B\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEDE\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3D\\uDF50\\uDF5D-\\uDF61]|\\uD805[\\uDC00-\\uDC34\\uDC47-\\uDC4A\\uDC80-\\uDCAF\\uDCC4\\uDCC5\\uDCC7\\uDD80-\\uDDAE\\uDDD8-\\uDDDB\\uDE00-\\uDE2F\\uDE44\\uDE80-\\uDEAA\\uDF00-\\uDF19]|\\uD806[\\uDCA0-\\uDCDF\\uDCFF\\uDE00\\uDE0B-\\uDE32\\uDE3A\\uDE50\\uDE5C-\\uDE83\\uDE86-\\uDE89\\uDEC0-\\uDEF8]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC2E\\uDC40\\uDC72-\\uDC8F\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD30\\uDD46]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|[\\uD80C\\uD81C-\\uD820\\uD840-\\uD868\\uD86A-\\uD86C\\uD86F-\\uD872\\uD874-\\uD879][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2E]|\\uD811[\\uDC00-\\uDE46]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDED0-\\uDEED\\uDF00-\\uDF2F\\uDF40-\\uDF43\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDF00-\\uDF44\\uDF50\\uDF93-\\uDF9F\\uDFE0\\uDFE1]|\\uD821[\\uDC00-\\uDFEC]|\\uD822[\\uDC00-\\uDEF2]|\\uD82C[\\uDC00-\\uDD1E\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB]|\\uD83A[\\uDC00-\\uDCC4\\uDD00-\\uDD43]|\\uD83B[\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD869[\\uDC00-\\uDED6\\uDF00-\\uDFFF]|\\uD86D[\\uDC00-\\uDF34\\uDF40-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEA1\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0]|\\uD87E[\\uDC00-\\uDE1D]/;\nvar ID_Continue = /[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08BD\\u08D4-\\u08E1\\u08E3-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u09FC\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0AF9-\\u0AFF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58-\\u0C5A\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C80-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D00-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D54-\\u0D57\\u0D5F-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1C80-\\u1C88\\u1CD0-\\u1CD2\\u1CD4-\\u1CF9\\u1D00-\\u1DF9\\u1DFB-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312E\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FEA\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C5\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA8FD\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD40-\\uDD74\\uDDFD\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDEE0\\uDF00-\\uDF1F\\uDF2D-\\uDF4A\\uDF50-\\uDF7A\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCA0-\\uDCA9\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC60-\\uDC76\\uDC80-\\uDC9E\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDD00-\\uDD15\\uDD20-\\uDD39\\uDD80-\\uDDB7\\uDDBE\\uDDBF\\uDE00-\\uDE03\\uDE05\\uDE06\\uDE0C-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE33\\uDE38-\\uDE3A\\uDE3F\\uDE60-\\uDE7C\\uDE80-\\uDE9C\\uDEC0-\\uDEC7\\uDEC9-\\uDEE6\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF60-\\uDF72\\uDF80-\\uDF91]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2]|\\uD804[\\uDC00-\\uDC46\\uDC66-\\uDC6F\\uDC7F-\\uDCBA\\uDCD0-\\uDCE8\\uDCF0-\\uDCF9\\uDD00-\\uDD34\\uDD36-\\uDD3F\\uDD50-\\uDD73\\uDD76\\uDD80-\\uDDC4\\uDDCA-\\uDDCC\\uDDD0-\\uDDDA\\uDDDC\\uDE00-\\uDE11\\uDE13-\\uDE37\\uDE3E\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEEA\\uDEF0-\\uDEF9\\uDF00-\\uDF03\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3C-\\uDF44\\uDF47\\uDF48\\uDF4B-\\uDF4D\\uDF50\\uDF57\\uDF5D-\\uDF63\\uDF66-\\uDF6C\\uDF70-\\uDF74]|\\uD805[\\uDC00-\\uDC4A\\uDC50-\\uDC59\\uDC80-\\uDCC5\\uDCC7\\uDCD0-\\uDCD9\\uDD80-\\uDDB5\\uDDB8-\\uDDC0\\uDDD8-\\uDDDD\\uDE00-\\uDE40\\uDE44\\uDE50-\\uDE59\\uDE80-\\uDEB7\\uDEC0-\\uDEC9\\uDF00-\\uDF19\\uDF1D-\\uDF2B\\uDF30-\\uDF39]|\\uD806[\\uDCA0-\\uDCE9\\uDCFF\\uDE00-\\uDE3E\\uDE47\\uDE50-\\uDE83\\uDE86-\\uDE99\\uDEC0-\\uDEF8]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC36\\uDC38-\\uDC40\\uDC50-\\uDC59\\uDC72-\\uDC8F\\uDC92-\\uDCA7\\uDCA9-\\uDCB6\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD36\\uDD3A\\uDD3C\\uDD3D\\uDD3F-\\uDD47\\uDD50-\\uDD59]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|[\\uD80C\\uD81C-\\uD820\\uD840-\\uD868\\uD86A-\\uD86C\\uD86F-\\uD872\\uD874-\\uD879][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2E]|\\uD811[\\uDC00-\\uDE46]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDE60-\\uDE69\\uDED0-\\uDEED\\uDEF0-\\uDEF4\\uDF00-\\uDF36\\uDF40-\\uDF43\\uDF50-\\uDF59\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDF00-\\uDF44\\uDF50-\\uDF7E\\uDF8F-\\uDF9F\\uDFE0\\uDFE1]|\\uD821[\\uDC00-\\uDFEC]|\\uD822[\\uDC00-\\uDEF2]|\\uD82C[\\uDC00-\\uDD1E\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99\\uDC9D\\uDC9E]|\\uD834[\\uDD65-\\uDD69\\uDD6D-\\uDD72\\uDD7B-\\uDD82\\uDD85-\\uDD8B\\uDDAA-\\uDDAD\\uDE42-\\uDE44]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB\\uDFCE-\\uDFFF]|\\uD836[\\uDE00-\\uDE36\\uDE3B-\\uDE6C\\uDE75\\uDE84\\uDE9B-\\uDE9F\\uDEA1-\\uDEAF]|\\uD838[\\uDC00-\\uDC06\\uDC08-\\uDC18\\uDC1B-\\uDC21\\uDC23\\uDC24\\uDC26-\\uDC2A]|\\uD83A[\\uDC00-\\uDCC4\\uDCD0-\\uDCD6\\uDD00-\\uDD4A\\uDD50-\\uDD59]|\\uD83B[\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD869[\\uDC00-\\uDED6\\uDF00-\\uDFFF]|\\uD86D[\\uDC00-\\uDF34\\uDF40-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEA1\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0]|\\uD87E[\\uDC00-\\uDE1D]|\\uDB40[\\uDD00-\\uDDEF]/;\n\nvar unicode = {\n\tSpace_Separator: Space_Separator,\n\tID_Start: ID_Start,\n\tID_Continue: ID_Continue\n};\n\nvar util = {\n    isSpaceSeparator (c) {\n        return typeof c === 'string' && unicode.Space_Separator.test(c)\n    },\n\n    isIdStartChar (c) {\n        return typeof c === 'string' && (\n            (c >= 'a' && c <= 'z') ||\n        (c >= 'A' && c <= 'Z') ||\n        (c === '$') || (c === '_') ||\n        unicode.ID_Start.test(c)\n        )\n    },\n\n    isIdContinueChar (c) {\n        return typeof c === 'string' && (\n            (c >= 'a' && c <= 'z') ||\n        (c >= 'A' && c <= 'Z') ||\n        (c >= '0' && c <= '9') ||\n        (c === '$') || (c === '_') ||\n        (c === '\\u200C') || (c === '\\u200D') ||\n        unicode.ID_Continue.test(c)\n        )\n    },\n\n    isDigit (c) {\n        return typeof c === 'string' && /[0-9]/.test(c)\n    },\n\n    isHexDigit (c) {\n        return typeof c === 'string' && /[0-9A-Fa-f]/.test(c)\n    },\n};\n\nlet source;\nlet parseState;\nlet stack;\nlet pos;\nlet line;\nlet column;\nlet token;\nlet key;\nlet root;\n\nvar parse = function parse (text, reviver) {\n    source = String(text);\n    parseState = 'start';\n    stack = [];\n    pos = 0;\n    line = 1;\n    column = 0;\n    token = undefined;\n    key = undefined;\n    root = undefined;\n\n    do {\n        token = lex();\n\n        // This code is unreachable.\n        // if (!parseStates[parseState]) {\n        //     throw invalidParseState()\n        // }\n\n        parseStates[parseState]();\n    } while (token.type !== 'eof')\n\n    if (typeof reviver === 'function') {\n        return internalize({'': root}, '', reviver)\n    }\n\n    return root\n};\n\nfunction internalize (holder, name, reviver) {\n    const value = holder[name];\n    if (value != null && typeof value === 'object') {\n        if (Array.isArray(value)) {\n            for (let i = 0; i < value.length; i++) {\n                const key = String(i);\n                const replacement = internalize(value, key, reviver);\n                if (replacement === undefined) {\n                    delete value[key];\n                } else {\n                    Object.defineProperty(value, key, {\n                        value: replacement,\n                        writable: true,\n                        enumerable: true,\n                        configurable: true,\n                    });\n                }\n            }\n        } else {\n            for (const key in value) {\n                const replacement = internalize(value, key, reviver);\n                if (replacement === undefined) {\n                    delete value[key];\n                } else {\n                    Object.defineProperty(value, key, {\n                        value: replacement,\n                        writable: true,\n                        enumerable: true,\n                        configurable: true,\n                    });\n                }\n            }\n        }\n    }\n\n    return reviver.call(holder, name, value)\n}\n\nlet lexState;\nlet buffer;\nlet doubleQuote;\nlet sign;\nlet c;\n\nfunction lex () {\n    lexState = 'default';\n    buffer = '';\n    doubleQuote = false;\n    sign = 1;\n\n    for (;;) {\n        c = peek();\n\n        // This code is unreachable.\n        // if (!lexStates[lexState]) {\n        //     throw invalidLexState(lexState)\n        // }\n\n        const token = lexStates[lexState]();\n        if (token) {\n            return token\n        }\n    }\n}\n\nfunction peek () {\n    if (source[pos]) {\n        return String.fromCodePoint(source.codePointAt(pos))\n    }\n}\n\nfunction read () {\n    const c = peek();\n\n    if (c === '\\n') {\n        line++;\n        column = 0;\n    } else if (c) {\n        column += c.length;\n    } else {\n        column++;\n    }\n\n    if (c) {\n        pos += c.length;\n    }\n\n    return c\n}\n\nconst lexStates = {\n    default () {\n        switch (c) {\n        case '\\t':\n        case '\\v':\n        case '\\f':\n        case ' ':\n        case '\\u00A0':\n        case '\\uFEFF':\n        case '\\n':\n        case '\\r':\n        case '\\u2028':\n        case '\\u2029':\n            read();\n            return\n\n        case '/':\n            read();\n            lexState = 'comment';\n            return\n\n        case undefined:\n            read();\n            return newToken('eof')\n        }\n\n        if (util.isSpaceSeparator(c)) {\n            read();\n            return\n        }\n\n        // This code is unreachable.\n        // if (!lexStates[parseState]) {\n        //     throw invalidLexState(parseState)\n        // }\n\n        return lexStates[parseState]()\n    },\n\n    comment () {\n        switch (c) {\n        case '*':\n            read();\n            lexState = 'multiLineComment';\n            return\n\n        case '/':\n            read();\n            lexState = 'singleLineComment';\n            return\n        }\n\n        throw invalidChar(read())\n    },\n\n    multiLineComment () {\n        switch (c) {\n        case '*':\n            read();\n            lexState = 'multiLineCommentAsterisk';\n            return\n\n        case undefined:\n            throw invalidChar(read())\n        }\n\n        read();\n    },\n\n    multiLineCommentAsterisk () {\n        switch (c) {\n        case '*':\n            read();\n            return\n\n        case '/':\n            read();\n            lexState = 'default';\n            return\n\n        case undefined:\n            throw invalidChar(read())\n        }\n\n        read();\n        lexState = 'multiLineComment';\n    },\n\n    singleLineComment () {\n        switch (c) {\n        case '\\n':\n        case '\\r':\n        case '\\u2028':\n        case '\\u2029':\n            read();\n            lexState = 'default';\n            return\n\n        case undefined:\n            read();\n            return newToken('eof')\n        }\n\n        read();\n    },\n\n    value () {\n        switch (c) {\n        case '{':\n        case '[':\n            return newToken('punctuator', read())\n\n        case 'n':\n            read();\n            literal('ull');\n            return newToken('null', null)\n\n        case 't':\n            read();\n            literal('rue');\n            return newToken('boolean', true)\n\n        case 'f':\n            read();\n            literal('alse');\n            return newToken('boolean', false)\n\n        case '-':\n        case '+':\n            if (read() === '-') {\n                sign = -1;\n            }\n\n            lexState = 'sign';\n            return\n\n        case '.':\n            buffer = read();\n            lexState = 'decimalPointLeading';\n            return\n\n        case '0':\n            buffer = read();\n            lexState = 'zero';\n            return\n\n        case '1':\n        case '2':\n        case '3':\n        case '4':\n        case '5':\n        case '6':\n        case '7':\n        case '8':\n        case '9':\n            buffer = read();\n            lexState = 'decimalInteger';\n            return\n\n        case 'I':\n            read();\n            literal('nfinity');\n            return newToken('numeric', Infinity)\n\n        case 'N':\n            read();\n            literal('aN');\n            return newToken('numeric', NaN)\n\n        case '\"':\n        case \"'\":\n            doubleQuote = (read() === '\"');\n            buffer = '';\n            lexState = 'string';\n            return\n        }\n\n        throw invalidChar(read())\n    },\n\n    identifierNameStartEscape () {\n        if (c !== 'u') {\n            throw invalidChar(read())\n        }\n\n        read();\n        const u = unicodeEscape();\n        switch (u) {\n        case '$':\n        case '_':\n            break\n\n        default:\n            if (!util.isIdStartChar(u)) {\n                throw invalidIdentifier()\n            }\n\n            break\n        }\n\n        buffer += u;\n        lexState = 'identifierName';\n    },\n\n    identifierName () {\n        switch (c) {\n        case '$':\n        case '_':\n        case '\\u200C':\n        case '\\u200D':\n            buffer += read();\n            return\n\n        case '\\\\':\n            read();\n            lexState = 'identifierNameEscape';\n            return\n        }\n\n        if (util.isIdContinueChar(c)) {\n            buffer += read();\n            return\n        }\n\n        return newToken('identifier', buffer)\n    },\n\n    identifierNameEscape () {\n        if (c !== 'u') {\n            throw invalidChar(read())\n        }\n\n        read();\n        const u = unicodeEscape();\n        switch (u) {\n        case '$':\n        case '_':\n        case '\\u200C':\n        case '\\u200D':\n            break\n\n        default:\n            if (!util.isIdContinueChar(u)) {\n                throw invalidIdentifier()\n            }\n\n            break\n        }\n\n        buffer += u;\n        lexState = 'identifierName';\n    },\n\n    sign () {\n        switch (c) {\n        case '.':\n            buffer = read();\n            lexState = 'decimalPointLeading';\n            return\n\n        case '0':\n            buffer = read();\n            lexState = 'zero';\n            return\n\n        case '1':\n        case '2':\n        case '3':\n        case '4':\n        case '5':\n        case '6':\n        case '7':\n        case '8':\n        case '9':\n            buffer = read();\n            lexState = 'decimalInteger';\n            return\n\n        case 'I':\n            read();\n            literal('nfinity');\n            return newToken('numeric', sign * Infinity)\n\n        case 'N':\n            read();\n            literal('aN');\n            return newToken('numeric', NaN)\n        }\n\n        throw invalidChar(read())\n    },\n\n    zero () {\n        switch (c) {\n        case '.':\n            buffer += read();\n            lexState = 'decimalPoint';\n            return\n\n        case 'e':\n        case 'E':\n            buffer += read();\n            lexState = 'decimalExponent';\n            return\n\n        case 'x':\n        case 'X':\n            buffer += read();\n            lexState = 'hexadecimal';\n            return\n        }\n\n        return newToken('numeric', sign * 0)\n    },\n\n    decimalInteger () {\n        switch (c) {\n        case '.':\n            buffer += read();\n            lexState = 'decimalPoint';\n            return\n\n        case 'e':\n        case 'E':\n            buffer += read();\n            lexState = 'decimalExponent';\n            return\n        }\n\n        if (util.isDigit(c)) {\n            buffer += read();\n            return\n        }\n\n        return newToken('numeric', sign * Number(buffer))\n    },\n\n    decimalPointLeading () {\n        if (util.isDigit(c)) {\n            buffer += read();\n            lexState = 'decimalFraction';\n            return\n        }\n\n        throw invalidChar(read())\n    },\n\n    decimalPoint () {\n        switch (c) {\n        case 'e':\n        case 'E':\n            buffer += read();\n            lexState = 'decimalExponent';\n            return\n        }\n\n        if (util.isDigit(c)) {\n            buffer += read();\n            lexState = 'decimalFraction';\n            return\n        }\n\n        return newToken('numeric', sign * Number(buffer))\n    },\n\n    decimalFraction () {\n        switch (c) {\n        case 'e':\n        case 'E':\n            buffer += read();\n            lexState = 'decimalExponent';\n            return\n        }\n\n        if (util.isDigit(c)) {\n            buffer += read();\n            return\n        }\n\n        return newToken('numeric', sign * Number(buffer))\n    },\n\n    decimalExponent () {\n        switch (c) {\n        case '+':\n        case '-':\n            buffer += read();\n            lexState = 'decimalExponentSign';\n            return\n        }\n\n        if (util.isDigit(c)) {\n            buffer += read();\n            lexState = 'decimalExponentInteger';\n            return\n        }\n\n        throw invalidChar(read())\n    },\n\n    decimalExponentSign () {\n        if (util.isDigit(c)) {\n            buffer += read();\n            lexState = 'decimalExponentInteger';\n            return\n        }\n\n        throw invalidChar(read())\n    },\n\n    decimalExponentInteger () {\n        if (util.isDigit(c)) {\n            buffer += read();\n            return\n        }\n\n        return newToken('numeric', sign * Number(buffer))\n    },\n\n    hexadecimal () {\n        if (util.isHexDigit(c)) {\n            buffer += read();\n            lexState = 'hexadecimalInteger';\n            return\n        }\n\n        throw invalidChar(read())\n    },\n\n    hexadecimalInteger () {\n        if (util.isHexDigit(c)) {\n            buffer += read();\n            return\n        }\n\n        return newToken('numeric', sign * Number(buffer))\n    },\n\n    string () {\n        switch (c) {\n        case '\\\\':\n            read();\n            buffer += escape();\n            return\n\n        case '\"':\n            if (doubleQuote) {\n                read();\n                return newToken('string', buffer)\n            }\n\n            buffer += read();\n            return\n\n        case \"'\":\n            if (!doubleQuote) {\n                read();\n                return newToken('string', buffer)\n            }\n\n            buffer += read();\n            return\n\n        case '\\n':\n        case '\\r':\n            throw invalidChar(read())\n\n        case '\\u2028':\n        case '\\u2029':\n            separatorChar(c);\n            break\n\n        case undefined:\n            throw invalidChar(read())\n        }\n\n        buffer += read();\n    },\n\n    start () {\n        switch (c) {\n        case '{':\n        case '[':\n            return newToken('punctuator', read())\n\n        // This code is unreachable since the default lexState handles eof.\n        // case undefined:\n        //     return newToken('eof')\n        }\n\n        lexState = 'value';\n    },\n\n    beforePropertyName () {\n        switch (c) {\n        case '$':\n        case '_':\n            buffer = read();\n            lexState = 'identifierName';\n            return\n\n        case '\\\\':\n            read();\n            lexState = 'identifierNameStartEscape';\n            return\n\n        case '}':\n            return newToken('punctuator', read())\n\n        case '\"':\n        case \"'\":\n            doubleQuote = (read() === '\"');\n            lexState = 'string';\n            return\n        }\n\n        if (util.isIdStartChar(c)) {\n            buffer += read();\n            lexState = 'identifierName';\n            return\n        }\n\n        throw invalidChar(read())\n    },\n\n    afterPropertyName () {\n        if (c === ':') {\n            return newToken('punctuator', read())\n        }\n\n        throw invalidChar(read())\n    },\n\n    beforePropertyValue () {\n        lexState = 'value';\n    },\n\n    afterPropertyValue () {\n        switch (c) {\n        case ',':\n        case '}':\n            return newToken('punctuator', read())\n        }\n\n        throw invalidChar(read())\n    },\n\n    beforeArrayValue () {\n        if (c === ']') {\n            return newToken('punctuator', read())\n        }\n\n        lexState = 'value';\n    },\n\n    afterArrayValue () {\n        switch (c) {\n        case ',':\n        case ']':\n            return newToken('punctuator', read())\n        }\n\n        throw invalidChar(read())\n    },\n\n    end () {\n        // This code is unreachable since it's handled by the default lexState.\n        // if (c === undefined) {\n        //     read()\n        //     return newToken('eof')\n        // }\n\n        throw invalidChar(read())\n    },\n};\n\nfunction newToken (type, value) {\n    return {\n        type,\n        value,\n        line,\n        column,\n    }\n}\n\nfunction literal (s) {\n    for (const c of s) {\n        const p = peek();\n\n        if (p !== c) {\n            throw invalidChar(read())\n        }\n\n        read();\n    }\n}\n\nfunction escape () {\n    const c = peek();\n    switch (c) {\n    case 'b':\n        read();\n        return '\\b'\n\n    case 'f':\n        read();\n        return '\\f'\n\n    case 'n':\n        read();\n        return '\\n'\n\n    case 'r':\n        read();\n        return '\\r'\n\n    case 't':\n        read();\n        return '\\t'\n\n    case 'v':\n        read();\n        return '\\v'\n\n    case '0':\n        read();\n        if (util.isDigit(peek())) {\n            throw invalidChar(read())\n        }\n\n        return '\\0'\n\n    case 'x':\n        read();\n        return hexEscape()\n\n    case 'u':\n        read();\n        return unicodeEscape()\n\n    case '\\n':\n    case '\\u2028':\n    case '\\u2029':\n        read();\n        return ''\n\n    case '\\r':\n        read();\n        if (peek() === '\\n') {\n            read();\n        }\n\n        return ''\n\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n        throw invalidChar(read())\n\n    case undefined:\n        throw invalidChar(read())\n    }\n\n    return read()\n}\n\nfunction hexEscape () {\n    let buffer = '';\n    let c = peek();\n\n    if (!util.isHexDigit(c)) {\n        throw invalidChar(read())\n    }\n\n    buffer += read();\n\n    c = peek();\n    if (!util.isHexDigit(c)) {\n        throw invalidChar(read())\n    }\n\n    buffer += read();\n\n    return String.fromCodePoint(parseInt(buffer, 16))\n}\n\nfunction unicodeEscape () {\n    let buffer = '';\n    let count = 4;\n\n    while (count-- > 0) {\n        const c = peek();\n        if (!util.isHexDigit(c)) {\n            throw invalidChar(read())\n        }\n\n        buffer += read();\n    }\n\n    return String.fromCodePoint(parseInt(buffer, 16))\n}\n\nconst parseStates = {\n    start () {\n        if (token.type === 'eof') {\n            throw invalidEOF()\n        }\n\n        push();\n    },\n\n    beforePropertyName () {\n        switch (token.type) {\n        case 'identifier':\n        case 'string':\n            key = token.value;\n            parseState = 'afterPropertyName';\n            return\n\n        case 'punctuator':\n            // This code is unreachable since it's handled by the lexState.\n            // if (token.value !== '}') {\n            //     throw invalidToken()\n            // }\n\n            pop();\n            return\n\n        case 'eof':\n            throw invalidEOF()\n        }\n\n        // This code is unreachable since it's handled by the lexState.\n        // throw invalidToken()\n    },\n\n    afterPropertyName () {\n        // This code is unreachable since it's handled by the lexState.\n        // if (token.type !== 'punctuator' || token.value !== ':') {\n        //     throw invalidToken()\n        // }\n\n        if (token.type === 'eof') {\n            throw invalidEOF()\n        }\n\n        parseState = 'beforePropertyValue';\n    },\n\n    beforePropertyValue () {\n        if (token.type === 'eof') {\n            throw invalidEOF()\n        }\n\n        push();\n    },\n\n    beforeArrayValue () {\n        if (token.type === 'eof') {\n            throw invalidEOF()\n        }\n\n        if (token.type === 'punctuator' && token.value === ']') {\n            pop();\n            return\n        }\n\n        push();\n    },\n\n    afterPropertyValue () {\n        // This code is unreachable since it's handled by the lexState.\n        // if (token.type !== 'punctuator') {\n        //     throw invalidToken()\n        // }\n\n        if (token.type === 'eof') {\n            throw invalidEOF()\n        }\n\n        switch (token.value) {\n        case ',':\n            parseState = 'beforePropertyName';\n            return\n\n        case '}':\n            pop();\n        }\n\n        // This code is unreachable since it's handled by the lexState.\n        // throw invalidToken()\n    },\n\n    afterArrayValue () {\n        // This code is unreachable since it's handled by the lexState.\n        // if (token.type !== 'punctuator') {\n        //     throw invalidToken()\n        // }\n\n        if (token.type === 'eof') {\n            throw invalidEOF()\n        }\n\n        switch (token.value) {\n        case ',':\n            parseState = 'beforeArrayValue';\n            return\n\n        case ']':\n            pop();\n        }\n\n        // This code is unreachable since it's handled by the lexState.\n        // throw invalidToken()\n    },\n\n    end () {\n        // This code is unreachable since it's handled by the lexState.\n        // if (token.type !== 'eof') {\n        //     throw invalidToken()\n        // }\n    },\n};\n\nfunction push () {\n    let value;\n\n    switch (token.type) {\n    case 'punctuator':\n        switch (token.value) {\n        case '{':\n            value = {};\n            break\n\n        case '[':\n            value = [];\n            break\n        }\n\n        break\n\n    case 'null':\n    case 'boolean':\n    case 'numeric':\n    case 'string':\n        value = token.value;\n        break\n\n    // This code is unreachable.\n    // default:\n    //     throw invalidToken()\n    }\n\n    if (root === undefined) {\n        root = value;\n    } else {\n        const parent = stack[stack.length - 1];\n        if (Array.isArray(parent)) {\n            parent.push(value);\n        } else {\n            Object.defineProperty(parent, key, {\n                value,\n                writable: true,\n                enumerable: true,\n                configurable: true,\n            });\n        }\n    }\n\n    if (value !== null && typeof value === 'object') {\n        stack.push(value);\n\n        if (Array.isArray(value)) {\n            parseState = 'beforeArrayValue';\n        } else {\n            parseState = 'beforePropertyName';\n        }\n    } else {\n        const current = stack[stack.length - 1];\n        if (current == null) {\n            parseState = 'end';\n        } else if (Array.isArray(current)) {\n            parseState = 'afterArrayValue';\n        } else {\n            parseState = 'afterPropertyValue';\n        }\n    }\n}\n\nfunction pop () {\n    stack.pop();\n\n    const current = stack[stack.length - 1];\n    if (current == null) {\n        parseState = 'end';\n    } else if (Array.isArray(current)) {\n        parseState = 'afterArrayValue';\n    } else {\n        parseState = 'afterPropertyValue';\n    }\n}\n\n// This code is unreachable.\n// function invalidParseState () {\n//     return new Error(`JSON5: invalid parse state '${parseState}'`)\n// }\n\n// This code is unreachable.\n// function invalidLexState (state) {\n//     return new Error(`JSON5: invalid lex state '${state}'`)\n// }\n\nfunction invalidChar (c) {\n    if (c === undefined) {\n        return syntaxError(`JSON5: invalid end of input at ${line}:${column}`)\n    }\n\n    return syntaxError(`JSON5: invalid character '${formatChar(c)}' at ${line}:${column}`)\n}\n\nfunction invalidEOF () {\n    return syntaxError(`JSON5: invalid end of input at ${line}:${column}`)\n}\n\n// This code is unreachable.\n// function invalidToken () {\n//     if (token.type === 'eof') {\n//         return syntaxError(`JSON5: invalid end of input at ${line}:${column}`)\n//     }\n\n//     const c = String.fromCodePoint(token.value.codePointAt(0))\n//     return syntaxError(`JSON5: invalid character '${formatChar(c)}' at ${line}:${column}`)\n// }\n\nfunction invalidIdentifier () {\n    column -= 5;\n    return syntaxError(`JSON5: invalid identifier character at ${line}:${column}`)\n}\n\nfunction separatorChar (c) {\n    console.warn(`JSON5: '${formatChar(c)}' in strings is not valid ECMAScript; consider escaping`);\n}\n\nfunction formatChar (c) {\n    const replacements = {\n        \"'\": \"\\\\'\",\n        '\"': '\\\\\"',\n        '\\\\': '\\\\\\\\',\n        '\\b': '\\\\b',\n        '\\f': '\\\\f',\n        '\\n': '\\\\n',\n        '\\r': '\\\\r',\n        '\\t': '\\\\t',\n        '\\v': '\\\\v',\n        '\\0': '\\\\0',\n        '\\u2028': '\\\\u2028',\n        '\\u2029': '\\\\u2029',\n    };\n\n    if (replacements[c]) {\n        return replacements[c]\n    }\n\n    if (c < ' ') {\n        const hexString = c.charCodeAt(0).toString(16);\n        return '\\\\x' + ('00' + hexString).substring(hexString.length)\n    }\n\n    return c\n}\n\nfunction syntaxError (message) {\n    const err = new SyntaxError(message);\n    err.lineNumber = line;\n    err.columnNumber = column;\n    return err\n}\n\nvar stringify = function stringify (value, replacer, space) {\n    const stack = [];\n    let indent = '';\n    let propertyList;\n    let replacerFunc;\n    let gap = '';\n    let quote;\n\n    if (\n        replacer != null &&\n        typeof replacer === 'object' &&\n        !Array.isArray(replacer)\n    ) {\n        space = replacer.space;\n        quote = replacer.quote;\n        replacer = replacer.replacer;\n    }\n\n    if (typeof replacer === 'function') {\n        replacerFunc = replacer;\n    } else if (Array.isArray(replacer)) {\n        propertyList = [];\n        for (const v of replacer) {\n            let item;\n\n            if (typeof v === 'string') {\n                item = v;\n            } else if (\n                typeof v === 'number' ||\n                v instanceof String ||\n                v instanceof Number\n            ) {\n                item = String(v);\n            }\n\n            if (item !== undefined && propertyList.indexOf(item) < 0) {\n                propertyList.push(item);\n            }\n        }\n    }\n\n    if (space instanceof Number) {\n        space = Number(space);\n    } else if (space instanceof String) {\n        space = String(space);\n    }\n\n    if (typeof space === 'number') {\n        if (space > 0) {\n            space = Math.min(10, Math.floor(space));\n            gap = '          '.substr(0, space);\n        }\n    } else if (typeof space === 'string') {\n        gap = space.substr(0, 10);\n    }\n\n    return serializeProperty('', {'': value})\n\n    function serializeProperty (key, holder) {\n        let value = holder[key];\n        if (value != null) {\n            if (typeof value.toJSON5 === 'function') {\n                value = value.toJSON5(key);\n            } else if (typeof value.toJSON === 'function') {\n                value = value.toJSON(key);\n            }\n        }\n\n        if (replacerFunc) {\n            value = replacerFunc.call(holder, key, value);\n        }\n\n        if (value instanceof Number) {\n            value = Number(value);\n        } else if (value instanceof String) {\n            value = String(value);\n        } else if (value instanceof Boolean) {\n            value = value.valueOf();\n        }\n\n        switch (value) {\n        case null: return 'null'\n        case true: return 'true'\n        case false: return 'false'\n        }\n\n        if (typeof value === 'string') {\n            return quoteString(value, false)\n        }\n\n        if (typeof value === 'number') {\n            return String(value)\n        }\n\n        if (typeof value === 'object') {\n            return Array.isArray(value) ? serializeArray(value) : serializeObject(value)\n        }\n\n        return undefined\n    }\n\n    function quoteString (value) {\n        const quotes = {\n            \"'\": 0.1,\n            '\"': 0.2,\n        };\n\n        const replacements = {\n            \"'\": \"\\\\'\",\n            '\"': '\\\\\"',\n            '\\\\': '\\\\\\\\',\n            '\\b': '\\\\b',\n            '\\f': '\\\\f',\n            '\\n': '\\\\n',\n            '\\r': '\\\\r',\n            '\\t': '\\\\t',\n            '\\v': '\\\\v',\n            '\\0': '\\\\0',\n            '\\u2028': '\\\\u2028',\n            '\\u2029': '\\\\u2029',\n        };\n\n        let product = '';\n\n        for (let i = 0; i < value.length; i++) {\n            const c = value[i];\n            switch (c) {\n            case \"'\":\n            case '\"':\n                quotes[c]++;\n                product += c;\n                continue\n\n            case '\\0':\n                if (util.isDigit(value[i + 1])) {\n                    product += '\\\\x00';\n                    continue\n                }\n            }\n\n            if (replacements[c]) {\n                product += replacements[c];\n                continue\n            }\n\n            if (c < ' ') {\n                let hexString = c.charCodeAt(0).toString(16);\n                product += '\\\\x' + ('00' + hexString).substring(hexString.length);\n                continue\n            }\n\n            product += c;\n        }\n\n        const quoteChar = quote || Object.keys(quotes).reduce((a, b) => (quotes[a] < quotes[b]) ? a : b);\n\n        product = product.replace(new RegExp(quoteChar, 'g'), replacements[quoteChar]);\n\n        return quoteChar + product + quoteChar\n    }\n\n    function serializeObject (value) {\n        if (stack.indexOf(value) >= 0) {\n            throw TypeError('Converting circular structure to JSON5')\n        }\n\n        stack.push(value);\n\n        let stepback = indent;\n        indent = indent + gap;\n\n        let keys = propertyList || Object.keys(value);\n        let partial = [];\n        for (const key of keys) {\n            const propertyString = serializeProperty(key, value);\n            if (propertyString !== undefined) {\n                let member = serializeKey(key) + ':';\n                if (gap !== '') {\n                    member += ' ';\n                }\n                member += propertyString;\n                partial.push(member);\n            }\n        }\n\n        let final;\n        if (partial.length === 0) {\n            final = '{}';\n        } else {\n            let properties;\n            if (gap === '') {\n                properties = partial.join(',');\n                final = '{' + properties + '}';\n            } else {\n                let separator = ',\\n' + indent;\n                properties = partial.join(separator);\n                final = '{\\n' + indent + properties + ',\\n' + stepback + '}';\n            }\n        }\n\n        stack.pop();\n        indent = stepback;\n        return final\n    }\n\n    function serializeKey (key) {\n        if (key.length === 0) {\n            return quoteString(key, true)\n        }\n\n        const firstChar = String.fromCodePoint(key.codePointAt(0));\n        if (!util.isIdStartChar(firstChar)) {\n            return quoteString(key, true)\n        }\n\n        for (let i = firstChar.length; i < key.length; i++) {\n            if (!util.isIdContinueChar(String.fromCodePoint(key.codePointAt(i)))) {\n                return quoteString(key, true)\n            }\n        }\n\n        return key\n    }\n\n    function serializeArray (value) {\n        if (stack.indexOf(value) >= 0) {\n            throw TypeError('Converting circular structure to JSON5')\n        }\n\n        stack.push(value);\n\n        let stepback = indent;\n        indent = indent + gap;\n\n        let partial = [];\n        for (let i = 0; i < value.length; i++) {\n            const propertyString = serializeProperty(String(i), value);\n            partial.push((propertyString !== undefined) ? propertyString : 'null');\n        }\n\n        let final;\n        if (partial.length === 0) {\n            final = '[]';\n        } else {\n            if (gap === '') {\n                let properties = partial.join(',');\n                final = '[' + properties + ']';\n            } else {\n                let separator = ',\\n' + indent;\n                let properties = partial.join(separator);\n                final = '[\\n' + indent + properties + ',\\n' + stepback + ']';\n            }\n        }\n\n        stack.pop();\n        indent = stepback;\n        return final\n    }\n};\n\nconst JSON5 = {\n    parse,\n    stringify,\n};\n\nvar lib = JSON5;\n\nexport default lib;\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1247, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/common.ts"],"sourcesContent":["/**\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getClientHeader as defaultGetClientHeader } from 'genkit';\nimport process from 'process';\n\nexport function getApiKeyFromEnvVar(): string | undefined {\n  return (\n    process.env.GEMINI_API_KEY ||\n    process.env.GOOGLE_API_KEY ||\n    process.env.GOOGLE_GENAI_API_KEY\n  );\n}\n\nexport function getGenkitClientHeader() {\n  if (process.env.MONOSPACE_ENV == 'true') {\n    return defaultGetClientHeader() + ' firebase-studio-vm';\n  }\n  return defaultGetClientHeader();\n}\n"],"names":["process","defaultGetClientHeader"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,iBAAA,CAAA;AAAA,SAAA,gBAAA;IAAA,qBAAA,IAAA;IAAA,uBAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAgBA,IAAA,gBAA0D;AAC1D,IAAA,iBAAoB;AAEb,SAAS,sBAA0C;IACxD,OACE,eAAAA,OAAAA,CAAQ,GAAA,CAAI,cAAA,IACZ,eAAAA,OAAAA,CAAQ,GAAA,CAAI,cAAA,IACZ,eAAAA,OAAAA,CAAQ,GAAA,CAAI,oBAAA;AAEhB;AAEO,SAAS,wBAAwB;IACtC,IAAI,eAAAA,OAAAA,CAAQ,GAAA,CAAI,aAAA,IAAiB,QAAQ;QACvC,OAAA,CAAA,GAAO,cAAAC,eAAAA,EAAuB,IAAI;IACpC;IACA,OAAA,CAAA,GAAO,cAAAA,eAAAA,EAAuB;AAChC","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1307, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/embedder.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GoogleGenerativeAI,\n  type EmbedContentRequest,\n} from '@google/generative-ai';\nimport {\n  GenkitError,\n  z,\n  type EmbedderAction,\n  type EmbedderReference,\n  type Genkit,\n} from 'genkit';\nimport { embedderRef } from 'genkit/embedder';\nimport { getApiKeyFromEnvVar } from './common.js';\nimport type { PluginOptions } from './index.js';\n\nexport const TaskTypeSchema = z.enum([\n  'RETRIEVAL_DOCUMENT',\n  'RETRIEVAL_QUERY',\n  'SEMANTIC_SIMILARITY',\n  'CLASSIFICATION',\n  'CLUSTERING',\n]);\nexport type TaskType = z.infer<typeof TaskTypeSchema>;\n\nexport const GeminiEmbeddingConfigSchema = z.object({\n  /** Override the API key provided at plugin initialization. */\n  apiKey: z.string().optional(),\n  /**\n   * The `task_type` parameter is defined as the intended downstream application to help the model\n   * produce better quality embeddings.\n   **/\n  taskType: TaskTypeSchema.optional(),\n  title: z.string().optional(),\n  version: z.string().optional(),\n  /**\n   * The `outputDimensionality` parameter allows you to specify the dimensionality of the embedding output.\n   * By default, the model generates embeddings with 768 dimensions. Models such as\n   * `text-embedding-004`, `text-embedding-005`, and `text-multilingual-embedding-002`\n   * allow the output dimensionality to be adjusted between 1 and 768.\n   * By selecting a smaller output dimensionality, users can save memory and storage space, leading to more efficient computations.\n   **/\n  outputDimensionality: z.number().min(1).max(768).optional(),\n});\n\nexport type GeminiEmbeddingConfig = z.infer<typeof GeminiEmbeddingConfigSchema>;\n\nexport const textEmbeddingGecko001 = embedderRef({\n  name: 'googleai/embedding-001',\n  configSchema: GeminiEmbeddingConfigSchema,\n  info: {\n    dimensions: 768,\n    label: 'Google Gen AI - Text Embedding Gecko (Legacy)',\n    supports: {\n      input: ['text'],\n    },\n  },\n});\n\nexport const textEmbedding004 = embedderRef({\n  name: 'googleai/text-embedding-004',\n  configSchema: GeminiEmbeddingConfigSchema,\n  info: {\n    dimensions: 768,\n    label: 'Google Gen AI - Text Embedding 001',\n    supports: {\n      input: ['text'],\n    },\n  },\n});\n\nexport const geminiEmbedding001 = embedderRef({\n  name: 'googleai/gemini-embedding-001',\n  configSchema: GeminiEmbeddingConfigSchema,\n  info: {\n    dimensions: 768,\n    label: 'Google Gen AI - Gemini Embedding 001',\n    supports: {\n      input: ['text'],\n    },\n  },\n});\n\nexport const SUPPORTED_MODELS = {\n  'embedding-001': textEmbeddingGecko001,\n  'text-embedding-004': textEmbedding004,\n  'gemini-embedding-001': geminiEmbedding001,\n};\n\nexport function defineGoogleAIEmbedder(\n  ai: Genkit,\n  name: string,\n  pluginOptions: PluginOptions\n): EmbedderAction<any> {\n  let apiKey: string | undefined;\n  // DO NOT throw if {apiKey: false} was supplied to options.\n  if (pluginOptions.apiKey !== false) {\n    apiKey = pluginOptions?.apiKey || getApiKeyFromEnvVar();\n    if (!apiKey)\n      throw new Error(\n        'Please pass in the API key or set either GEMINI_API_KEY or GOOGLE_API_KEY environment variable.\\n' +\n          'For more details see https://genkit.dev/docs/plugins/google-genai'\n      );\n  }\n  const embedder: EmbedderReference =\n    SUPPORTED_MODELS[name] ??\n    embedderRef({\n      name: name,\n      configSchema: GeminiEmbeddingConfigSchema,\n      info: {\n        dimensions: 768,\n        label: `Google AI - ${name}`,\n        supports: {\n          input: ['text', 'image', 'video'],\n        },\n      },\n    });\n  const apiModelName = embedder.name.startsWith('googleai/')\n    ? embedder.name.substring('googleai/'.length)\n    : embedder.name;\n  return ai.defineEmbedder(\n    {\n      name: embedder.name,\n      configSchema: GeminiEmbeddingConfigSchema,\n      info: embedder.info!,\n    },\n    async (input, options) => {\n      if (pluginOptions.apiKey === false && !options?.apiKey) {\n        throw new GenkitError({\n          status: 'INVALID_ARGUMENT',\n          message:\n            'GoogleAI plugin was initialized with {apiKey: false} but no apiKey configuration was passed at call time.',\n        });\n      }\n      const client = new GoogleGenerativeAI(\n        options?.apiKey || apiKey!\n      ).getGenerativeModel({\n        model:\n          options?.version ||\n          embedder.config?.version ||\n          embedder.version ||\n          apiModelName,\n      });\n      const embeddings = await Promise.all(\n        input.map(async (doc) => {\n          const response = await client.embedContent({\n            taskType: options?.taskType,\n            title: options?.title,\n            content: {\n              role: '',\n              parts: [{ text: doc.text }],\n            },\n            outputDimensionality: options?.outputDimensionality,\n          } as EmbedContentRequest);\n          const values = response.embedding.values;\n          return { embedding: values };\n        })\n      );\n      return { embeddings };\n    }\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,mBAAA,CAAA;AAAA,SAAA,kBAAA;IAAA,6BAAA,IAAA;IAAA,kBAAA,IAAA;IAAA,gBAAA,IAAA;IAAA,wBAAA,IAAA;IAAA,oBAAA,IAAA;IAAA,kBAAA,IAAA;IAAA,uBAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAgBA,IAAA,uBAGO;AACP,IAAA,gBAMO;AACP,IAAA,kBAA4B;AAC5B,IAAA,gBAAoC;AAG7B,MAAM,iBAAiB,cAAA,CAAA,CAAE,IAAA,CAAK;IACnC;IACA;IACA;IACA;IACA;CACD;AAGM,MAAM,8BAA8B,cAAA,CAAA,CAAE,MAAA,CAAO;IAAA,4DAAA,GAElD,QAAQ,cAAA,CAAA,CAAE,MAAA,CAAO,EAAE,QAAA,CAAS;IAAA;;;IAAA,GAK5B,UAAU,eAAe,QAAA,CAAS;IAClC,OAAO,cAAA,CAAA,CAAE,MAAA,CAAO,EAAE,QAAA,CAAS;IAC3B,SAAS,cAAA,CAAA,CAAE,MAAA,CAAO,EAAE,QAAA,CAAS;IAAA;;;;;;IAAA,GAQ7B,sBAAsB,cAAA,CAAA,CAAE,MAAA,CAAO,EAAE,GAAA,CAAI,CAAC,EAAE,GAAA,CAAI,GAAG,EAAE,QAAA,CAAS;AAC5D,CAAC;AAIM,MAAM,wBAAA,CAAA,GAAwB,gBAAA,WAAA,EAAY;IAC/C,MAAM;IACN,cAAc;IACd,MAAM;QACJ,YAAY;QACZ,OAAO;QACP,UAAU;YACR,OAAO;gBAAC,MAAM;aAAA;QAChB;IACF;AACF,CAAC;AAEM,MAAM,mBAAA,CAAA,GAAmB,gBAAA,WAAA,EAAY;IAC1C,MAAM;IACN,cAAc;IACd,MAAM;QACJ,YAAY;QACZ,OAAO;QACP,UAAU;YACR,OAAO;gBAAC,MAAM;aAAA;QAChB;IACF;AACF,CAAC;AAEM,MAAM,qBAAA,CAAA,GAAqB,gBAAA,WAAA,EAAY;IAC5C,MAAM;IACN,cAAc;IACd,MAAM;QACJ,YAAY;QACZ,OAAO;QACP,UAAU;YACR,OAAO;gBAAC,MAAM;aAAA;QAChB;IACF;AACF,CAAC;AAEM,MAAM,mBAAmB;IAC9B,iBAAiB;IACjB,sBAAsB;IACtB,wBAAwB;AAC1B;AAEO,SAAS,uBACd,EAAA,EACA,IAAA,EACA,aAAA,EACqB;IACrB,IAAI;IAEJ,IAAI,cAAc,MAAA,KAAW,OAAO;QAClC,SAAS,eAAe,UAAA,CAAA,GAAU,cAAA,mBAAA,EAAoB;QACtD,IAAI,CAAC,QACH,MAAM,IAAI,MACR;IAGN;IACA,MAAM,WACJ,gBAAA,CAAiB,IAAI,CAAA,IAAA,CAAA,GACrB,gBAAA,WAAA,EAAY;QACV;QACA,cAAc;QACd,MAAM;YACJ,YAAY;YACZ,OAAO,CAAA,YAAA,EAAe,IAAI,EAAA;YAC1B,UAAU;gBACR,OAAO;oBAAC;oBAAQ;oBAAS,OAAO;iBAAA;YAClC;QACF;IACF,CAAC;IACH,MAAM,eAAe,SAAS,IAAA,CAAK,UAAA,CAAW,WAAW,IACrD,SAAS,IAAA,CAAK,SAAA,CAAU,YAAY,MAAM,IAC1C,SAAS,IAAA;IACb,OAAO,GAAG,cAAA,CACR;QACE,MAAM,SAAS,IAAA;QACf,cAAc;QACd,MAAM,SAAS,IAAA;IACjB,GACA,OAAO,OAAO,YAAY;QACxB,IAAI,cAAc,MAAA,KAAW,SAAS,CAAC,SAAS,QAAQ;YACtD,MAAM,IAAI,cAAA,WAAA,CAAY;gBACpB,QAAQ;gBACR,SACE;YACJ,CAAC;QACH;QACA,MAAM,SAAS,IAAI,qBAAA,kBAAA,CACjB,SAAS,UAAU,QACnB,kBAAA,CAAmB;YACnB,OACE,SAAS,WACT,SAAS,MAAA,EAAQ,WACjB,SAAS,OAAA,IACT;QACJ,CAAC;QACD,MAAM,aAAa,MAAM,QAAQ,GAAA,CAC/B,MAAM,GAAA,CAAI,OAAO,QAAQ;YACvB,MAAM,WAAW,MAAM,OAAO,YAAA,CAAa;gBACzC,UAAU,SAAS;gBACnB,OAAO,SAAS;gBAChB,SAAS;oBACP,MAAM;oBACN,OAAO;wBAAC;4BAAE,MAAM,IAAI,IAAA;wBAAK,CAAC;qBAAA;gBAC5B;gBACA,sBAAsB,SAAS;YACjC,CAAwB;YACxB,MAAM,SAAS,SAAS,SAAA,CAAU,MAAA;YAClC,OAAO;gBAAE,WAAW;YAAO;QAC7B,CAAC;QAEH,OAAO;YAAE;QAAW;IACtB;AAEJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1487, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/context-caching/constants.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const CONTEXT_CACHE_SUPPORTED_MODELS = [\n  'gemini-1.5-flash-001',\n  'gemini-1.5-pro-001',\n];\n\nexport const INVALID_ARGUMENT_MESSAGES = {\n  modelVersion: `Model version is required for context caching, supported only in ${CONTEXT_CACHE_SUPPORTED_MODELS.join(',')} models.`,\n  tools: 'Context caching cannot be used simultaneously with tools.',\n  codeExecution:\n    'Context caching cannot be used simultaneously with code execution.',\n};\n\nexport const DEFAULT_TTL = 300;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,oBAAA,CAAA;AAAA,SAAA,mBAAA;IAAA,gCAAA,IAAA;IAAA,aAAA,IAAA;IAAA,2BAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAgBO,MAAM,iCAAiC;IAC5C;IACA;CACF;AAEO,MAAM,4BAA4B;IACvC,cAAc,CAAA,iEAAA,EAAoE,+BAA+B,IAAA,CAAK,GAAG,CAAC,CAAA,QAAA,CAAA;IAC1H,OAAO;IACP,eACE;AACJ;AAEO,MAAM,cAAc","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1538, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/context-caching/types.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { z } from 'genkit';\n\nexport const cacheConfigSchema = z.union([\n  z.boolean(),\n  z.object({ ttlSeconds: z.number().optional() }).passthrough(),\n]);\n\nexport type CacheConfig = z.infer<typeof cacheConfigSchema>;\n\nexport const cacheConfigDetailsSchema = z.object({\n  cacheConfig: cacheConfigSchema,\n  endOfCachedContents: z.number(),\n});\n\nexport type CacheConfigDetails = z.infer<typeof cacheConfigDetailsSchema>;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,gBAAA,CAAA;AAAA,SAAA,eAAA;IAAA,0BAAA,IAAA;IAAA,mBAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAgBA,IAAA,gBAAkB;AAEX,MAAM,oBAAoB,cAAA,CAAA,CAAE,KAAA,CAAM;IACvC,cAAA,CAAA,CAAE,OAAA,CAAQ;IACV,cAAA,CAAA,CAAE,MAAA,CAAO;QAAE,YAAY,cAAA,CAAA,CAAE,MAAA,CAAO,EAAE,QAAA,CAAS;IAAE,CAAC,EAAE,WAAA,CAAY;CAC7D;AAIM,MAAM,2BAA2B,cAAA,CAAA,CAAE,MAAA,CAAO;IAC/C,aAAa;IACb,qBAAqB,cAAA,CAAA,CAAE,MAAA,CAAO;AAChC,CAAC","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1588, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/context-caching/utils.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CachedContent, StartChatParams } from '@google/generative-ai';\nimport type { GoogleAICacheManager } from '@google/generative-ai/server';\nimport crypto from 'crypto';\nimport { GenkitError, type MessageData, type z } from 'genkit';\nimport type { GenerateRequest } from 'genkit/model';\nimport {\n  CONTEXT_CACHE_SUPPORTED_MODELS,\n  DEFAULT_TTL,\n  INVALID_ARGUMENT_MESSAGES,\n} from './constants';\nimport {\n  cacheConfigSchema,\n  type CacheConfig,\n  type CacheConfigDetails,\n} from './types';\n\n/**\n * Generates a SHA-256 hash to use as a cache key.\n * @param request CachedContent - request object to hash\n * @returns string - the generated cache key\n */\nexport function generateCacheKey(request: CachedContent): string {\n  return crypto\n    .createHash('sha256')\n    .update(JSON.stringify(request))\n    .digest('hex');\n}\n\n/**\n * Retrieves the content needed for the cache based on the chat history and config details.\n */\nexport function getContentForCache(\n  request: GenerateRequest<z.ZodTypeAny>,\n  chatRequest: StartChatParams,\n  modelVersion: string,\n  cacheConfigDetails: CacheConfigDetails\n): {\n  cachedContent: CachedContent;\n  chatRequest: StartChatParams;\n  cacheConfig?: CacheConfig;\n} {\n  // Ensure modelVersion is provided\n  if (!modelVersion) {\n    throw new Error('No model version provided for context caching');\n  }\n\n  // Ensure chatRequest has a history\n  if (!chatRequest.history?.length) {\n    throw new Error('No history provided for context caching');\n  }\n\n  // Validate the history length between request and chatRequest\n  validateHistoryLength(request, chatRequest);\n\n  // Extract relevant cached content based on cacheConfigDetails\n  const { endOfCachedContents, cacheConfig } = cacheConfigDetails;\n  const cachedContent: CachedContent = {\n    model: modelVersion,\n    contents: chatRequest.history.slice(0, endOfCachedContents + 1),\n  };\n\n  // Update the chatRequest history to only include non-cached parts\n  chatRequest.history = chatRequest.history.slice(endOfCachedContents + 1);\n\n  return { cachedContent, chatRequest, cacheConfig };\n}\n\n/**\n * Validates that the request and chat request history lengths align.\n * @throws GenkitError if lengths are mismatched\n */\nfunction validateHistoryLength(\n  request: GenerateRequest<z.ZodTypeAny>,\n  chatRequest: StartChatParams\n) {\n  if (chatRequest.history?.length !== request.messages.length - 1) {\n    throw new GenkitError({\n      status: 'INTERNAL',\n      message:\n        'Genkit request history and Gemini chat request history length do not match',\n    });\n  }\n}\n\n/**\n * Looks up context cache using a cache manager and returns the found item, if any.\n */\n/**\n * Looks up context cache using a cache manager and returns the found item, if any.\n */\nexport async function lookupContextCache(\n  cacheManager: GoogleAICacheManager,\n  cacheKey: string,\n  maxPages = 100,\n  pageSize = 100\n): Promise<CachedContent | null> {\n  let currentPage = 0;\n  let pageToken: string | undefined;\n\n  try {\n    while (currentPage < maxPages) {\n      const { cachedContents, nextPageToken } = await cacheManager.list({\n        pageSize,\n        pageToken,\n      });\n\n      // Check for the cached content by key\n      const found = cachedContents?.find(\n        (content) => content.displayName === cacheKey\n      );\n\n      if (found) return found; // Return found content\n\n      // Stop if there's no next page\n      if (!nextPageToken) break;\n\n      pageToken = nextPageToken;\n      currentPage++;\n    }\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : 'Unknown Network Error';\n\n    throw new GenkitError({\n      status: 'INTERNAL',\n      message: `Error looking up context cache: ${message}`,\n    });\n  }\n\n  return null; // Return null if not found or on error\n}\n\n/**\n * Extracts the cache configuration from the request if available.\n */\nexport const extractCacheConfig = (\n  request: GenerateRequest<z.ZodTypeAny>\n): {\n  cacheConfig: { ttlSeconds?: number } | boolean;\n  endOfCachedContents: number;\n} | null => {\n  const endOfCachedContents = findLastIndex<MessageData>(\n    request.messages,\n    (message) => !!message.metadata?.cache\n  );\n\n  return endOfCachedContents === -1\n    ? null\n    : {\n        endOfCachedContents,\n        cacheConfig: cacheConfigSchema.parse(\n          request.messages[endOfCachedContents].metadata?.cache\n        ),\n      };\n};\n\n/**\n * Validates context caching request for compatibility with model and request configurations.\n */\nexport function validateContextCacheRequest(\n  request: GenerateRequest<z.ZodTypeAny>,\n  modelVersion: string\n): boolean {\n  if (!modelVersion || !CONTEXT_CACHE_SUPPORTED_MODELS.includes(modelVersion)) {\n    throw new GenkitError({\n      status: 'INVALID_ARGUMENT',\n      message: INVALID_ARGUMENT_MESSAGES.modelVersion,\n    });\n  }\n  if (request.tools?.length)\n    throw new GenkitError({\n      status: 'INVALID_ARGUMENT',\n      message: INVALID_ARGUMENT_MESSAGES.tools,\n    });\n  if (request.config?.codeExecution)\n    throw new GenkitError({\n      status: 'INVALID_ARGUMENT',\n      message: INVALID_ARGUMENT_MESSAGES.codeExecution,\n    });\n\n  return true;\n}\n\n/**\n * Polyfill function for Array.prototype.findLastIndex for ES2015 compatibility.\n */\nexport function findLastIndex<T>(\n  array: T[],\n  callback: (element: T, index: number, array: T[]) => boolean\n): number {\n  for (let i = array.length - 1; i >= 0; i--) {\n    if (callback(array[i], i, array)) return i;\n  }\n  return -1;\n}\n\n/**\n * Calculates the TTL (Time-To-Live) for the cache based on cacheConfigDetails.\n * @param cacheConfig - The caching configuration details.\n * @returns The TTL in seconds.\n */\nexport function calculateTTL(cacheConfig: CacheConfigDetails): number {\n  if (cacheConfig.cacheConfig === true) {\n    return DEFAULT_TTL;\n  }\n  if (cacheConfig.cacheConfig === false) {\n    return 0;\n  }\n  return cacheConfig.cacheConfig.ttlSeconds || DEFAULT_TTL;\n}\n"],"names":["crypto"],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1745, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/context-caching/index.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CachedContent, StartChatParams } from '@google/generative-ai';\nimport {\n  GoogleAICacheManager,\n  type CachedContentCreateParams,\n} from '@google/generative-ai/server';\nimport { GenkitError, type GenerateRequest, type z } from 'genkit';\nimport { logger } from 'genkit/logging';\nimport type { CacheConfigDetails } from './types.js';\nimport {\n  calculateTTL,\n  generateCacheKey,\n  getContentForCache,\n  lookupContextCache,\n  validateContextCacheRequest,\n} from './utils.js';\n\n/**\n * Handles context caching and transforms the chatRequest\n * @param apiKey\n * @param request\n * @param chatRequest\n * @param modelVersion\n * @returns\n */\nexport async function handleContextCache(\n  apiKey: string,\n  request: GenerateRequest<z.ZodTypeAny>,\n  chatRequest: StartChatParams,\n  modelVersion: string,\n  cacheConfigDetails: CacheConfigDetails\n): Promise<{ cache: CachedContent; newChatRequest: StartChatParams }> {\n  const cacheManager = new GoogleAICacheManager(apiKey);\n\n  const { cachedContent, chatRequest: newChatRequest } = getContentForCache(\n    request,\n    chatRequest,\n    modelVersion,\n    cacheConfigDetails\n  );\n  cachedContent.model = modelVersion;\n  const cacheKey = generateCacheKey(cachedContent);\n\n  cachedContent.displayName = cacheKey;\n\n  let cache = await lookupContextCache(cacheManager, cacheKey);\n  logger.debug(`Cache hit: ${cache ? 'true' : 'false'}`);\n\n  if (!cache) {\n    try {\n      logger.debug('No cache found, creating one.');\n      const createParams: CachedContentCreateParams = {\n        ...cachedContent,\n        ttlSeconds: calculateTTL(cacheConfigDetails),\n      };\n      cache = await cacheManager.create(createParams);\n      logger.debug(`Created new cache entry with key: ${cacheKey}`);\n    } catch (cacheError) {\n      logger.error(\n        `Failed to create cache with key ${cacheKey}: ${cacheError}`\n      );\n      throw new GenkitError({\n        status: 'INTERNAL',\n        message: `Failed to create cache: ${cacheError}`,\n      });\n    }\n  }\n\n  if (!cache) {\n    throw new GenkitError({\n      status: 'INTERNAL',\n      message: 'Failed to use context cache feature',\n    });\n  }\n\n  return { cache, newChatRequest };\n}\n\n/**\n * Handles cache validation, creation, and usage, transforming the chatRequest if necessary.\n * @param apiKey The API key for accessing Google AI Gemini.\n * @param request The generate request passed to the model.\n * @param chatRequest The current chat request configuration.\n * @param modelVersion The version of the model being used.\n * @param cacheConfigDetails Configuration details for caching.\n * @returns A transformed chat request and cache data (if applicable).\n */\nexport async function handleCacheIfNeeded(\n  apiKey: string,\n  request: GenerateRequest<z.ZodTypeAny>,\n  chatRequest: StartChatParams,\n  modelVersion: string,\n  cacheConfigDetails: CacheConfigDetails | null\n): Promise<{ chatRequest: StartChatParams; cache: CachedContent | null }> {\n  // Skip caching if no configuration or if validation fails\n  if (\n    !cacheConfigDetails ||\n    !validateContextCacheRequest(request, modelVersion)\n  ) {\n    return { chatRequest, cache: null };\n  }\n\n  const { cache, newChatRequest } = await handleContextCache(\n    apiKey,\n    request,\n    chatRequest,\n    modelVersion,\n    cacheConfigDetails\n  );\n  return { chatRequest: newChatRequest, cache };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,0BAAA,CAAA;AAAA,SAAA,yBAAA;IAAA,qBAAA,IAAA;IAAA,oBAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAiBA,IAAA,gBAGO;AACP,IAAA,gBAA0D;AAC1D,IAAA,iBAAuB;AAEvB,IAAA,eAMO;AAUP,eAAsB,mBACpB,MAAA,EACA,OAAA,EACA,WAAA,EACA,YAAA,EACA,kBAAA,EACoE;IACpE,MAAM,eAAe,IAAI,cAAA,oBAAA,CAAqB,MAAM;IAEpD,MAAM,EAAE,aAAA,EAAe,aAAa,cAAA,CAAe,CAAA,GAAA,CAAA,GAAI,aAAA,kBAAA,EACrD,SACA,aACA,cACA;IAEF,cAAc,KAAA,GAAQ;IACtB,MAAM,WAAA,CAAA,GAAW,aAAA,gBAAA,EAAiB,aAAa;IAE/C,cAAc,WAAA,GAAc;IAE5B,IAAI,QAAQ,MAAA,CAAA,GAAM,aAAA,kBAAA,EAAmB,cAAc,QAAQ;IAC3D,eAAA,MAAA,CAAO,KAAA,CAAM,CAAA,WAAA,EAAc,QAAQ,SAAS,OAAO,EAAE;IAErD,IAAI,CAAC,OAAO;QACV,IAAI;YACF,eAAA,MAAA,CAAO,KAAA,CAAM,+BAA+B;YAC5C,MAAM,eAA0C;gBAC9C,GAAG,aAAA;gBACH,YAAA,CAAA,GAAY,aAAA,YAAA,EAAa,kBAAkB;YAC7C;YACA,QAAQ,MAAM,aAAa,MAAA,CAAO,YAAY;YAC9C,eAAA,MAAA,CAAO,KAAA,CAAM,CAAA,kCAAA,EAAqC,QAAQ,EAAE;QAC9D,EAAA,OAAS,YAAY;YACnB,eAAA,MAAA,CAAO,KAAA,CACL,CAAA,gCAAA,EAAmC,QAAQ,CAAA,EAAA,EAAK,UAAU,EAAA;YAE5D,MAAM,IAAI,cAAA,WAAA,CAAY;gBACpB,QAAQ;gBACR,SAAS,CAAA,wBAAA,EAA2B,UAAU,EAAA;YAChD,CAAC;QACH;IACF;IAEA,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,cAAA,WAAA,CAAY;YACpB,QAAQ;YACR,SAAS;QACX,CAAC;IACH;IAEA,OAAO;QAAE;QAAO;IAAe;AACjC;AAWA,eAAsB,oBACpB,MAAA,EACA,OAAA,EACA,WAAA,EACA,YAAA,EACA,kBAAA,EACwE;IAExE,IACE,CAAC,sBACD,CAAA,CAAA,GAAC,aAAA,2BAAA,EAA4B,SAAS,YAAY,GAClD;QACA,OAAO;YAAE;YAAa,OAAO;QAAK;IACpC;IAEA,MAAM,EAAE,KAAA,EAAO,cAAA,CAAe,CAAA,GAAI,MAAM,mBACtC,QACA,SACA,aACA,cACA;IAEF,OAAO;QAAE,aAAa;QAAgB;IAAM;AAC9C","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1837, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/gemini.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FunctionCallingMode,\n  GenerateContentCandidate,\n  GoogleGenerativeAI,\n  SchemaType,\n  type FileDataPart,\n  type FunctionCallPart,\n  type FunctionDeclaration,\n  type FunctionResponsePart,\n  type GenerateContentCandidate as GeminiCandidate,\n  type Content as GeminiMessage,\n  type Part as GeminiPart,\n  type GenerateContentResponse,\n  type GenerationConfig,\n  type GenerativeModel,\n  type GoogleSearchRetrievalTool,\n  type InlineDataPart,\n  type RequestOptions,\n  type Schema,\n  type StartChatParams,\n  type Tool,\n  type ToolConfig,\n  type UsageMetadata,\n} from '@google/generative-ai';\nimport { GenkitError, z, type Genkit, type JSONSchema } from 'genkit';\nimport {\n  GenerationCommonConfigDescriptions,\n  GenerationCommonConfigSchema,\n  getBasicUsageStats,\n  modelRef,\n  type CandidateData,\n  type MediaPart,\n  type MessageData,\n  type ModelAction,\n  type ModelInfo,\n  type ModelMiddleware,\n  type ModelReference,\n  type Part,\n  type ToolDefinitionSchema,\n  type ToolRequestPart,\n  type ToolResponsePart,\n} from 'genkit/model';\nimport { downloadRequestMedia } from 'genkit/model/middleware';\nimport { runInNewSpan } from 'genkit/tracing';\nimport { getApiKeyFromEnvVar, getGenkitClientHeader } from './common';\nimport { handleCacheIfNeeded } from './context-caching';\nimport { extractCacheConfig } from './context-caching/utils';\n\n// Extra type guard to keep the compiler happy and avoid a cast to any. The\n// legacy Gemini SDK is no longer maintained, and doesn't have updated types.\n// However, the REST API returns the data we want.\ntype ExtendedUsageMetadata = UsageMetadata & {\n  thoughtsTokenCount?: number;\n};\n\n/**\n * See https://ai.google.dev/gemini-api/docs/safety-settings#safety-filters.\n */\nconst SafetySettingsSchema = z.object({\n  category: z.enum([\n    'HARM_CATEGORY_UNSPECIFIED',\n    'HARM_CATEGORY_HATE_SPEECH',\n    'HARM_CATEGORY_SEXUALLY_EXPLICIT',\n    'HARM_CATEGORY_HARASSMENT',\n    'HARM_CATEGORY_DANGEROUS_CONTENT',\n    'HARM_CATEGORY_CIVIC_INTEGRITY',\n  ]),\n  threshold: z.enum([\n    'BLOCK_LOW_AND_ABOVE',\n    'BLOCK_MEDIUM_AND_ABOVE',\n    'BLOCK_ONLY_HIGH',\n    'BLOCK_NONE',\n  ]),\n});\n\nconst VoiceConfigSchema = z\n  .object({\n    prebuiltVoiceConfig: z\n      .object({\n        // TODO: Make this an array of objects so we can also specify the description\n        // for each voiceName.\n        voiceName: z\n          .union([\n            z.enum([\n              'Zephyr',\n              'Puck',\n              'Charon',\n              'Kore',\n              'Fenrir',\n              'Leda',\n              'Orus',\n              'Aoede',\n              'Callirrhoe',\n              'Autonoe',\n              'Enceladus',\n              'Iapetus',\n              'Umbriel',\n              'Algieba',\n              'Despina',\n              'Erinome',\n              'Algenib',\n              'Rasalgethi',\n              'Laomedeia',\n              'Achernar',\n              'Alnilam',\n              'Schedar',\n              'Gacrux',\n              'Pulcherrima',\n              'Achird',\n              'Zubenelgenubi',\n              'Vindemiatrix',\n              'Sadachbia',\n              'Sadaltager',\n              'Sulafat',\n            ]),\n            // To allow any new string values\n            z.string(),\n          ])\n          .describe('Name of the preset voice to use')\n          .optional(),\n      })\n      .describe('Configuration for the prebuilt speaker to use')\n      .passthrough()\n      .optional(),\n  })\n  .describe('Configuration for the voice to use')\n  .passthrough();\n\nexport const GeminiConfigSchema = GenerationCommonConfigSchema.extend({\n  temperature: z\n    .number()\n    .min(0)\n    .max(2)\n    .describe(\n      GenerationCommonConfigDescriptions.temperature +\n        ' The default value is 1.0.'\n    )\n    .optional(),\n  topP: z\n    .number()\n    .min(0)\n    .max(1)\n    .describe(\n      GenerationCommonConfigDescriptions.topP + ' The default value is 0.95.'\n    )\n    .optional(),\n  apiKey: z\n    .string()\n    .describe('Overrides the plugin-configured API key, if specified.')\n    .optional(),\n  safetySettings: z\n    .array(SafetySettingsSchema)\n    .describe(\n      'Adjust how likely you are to see responses that could be harmful. ' +\n        'Content is blocked based on the probability that it is harmful.'\n    )\n    .optional(),\n  codeExecution: z\n    .union([z.boolean(), z.object({}).strict()])\n    .describe('Enables the model to generate and run code.')\n    .optional(),\n  contextCache: z\n    .boolean()\n    .describe(\n      'Context caching allows you to save and reuse precomputed input ' +\n        'tokens that you wish to use repeatedly.'\n    )\n    .optional(),\n  functionCallingConfig: z\n    .object({\n      mode: z.enum(['MODE_UNSPECIFIED', 'AUTO', 'ANY', 'NONE']).optional(),\n      allowedFunctionNames: z.array(z.string()).optional(),\n    })\n    .describe(\n      'Controls how the model uses the provided tools (function declarations). ' +\n        'With AUTO (Default) mode, the model decides whether to generate a ' +\n        'natural language response or suggest a function call based on the ' +\n        'prompt and context. With ANY, the model is constrained to always ' +\n        'predict a function call and guarantee function schema adherence. ' +\n        'With NONE, the model is prohibited from making function calls.'\n    )\n    .optional(),\n  responseModalities: z\n    .array(z.enum(['TEXT', 'IMAGE', 'AUDIO']))\n    .describe(\n      'The modalities to be used in response. Only supported for ' +\n        \"'gemini-2.0-flash-exp' model at present.\"\n    )\n    .optional(),\n  googleSearchRetrieval: z\n    .union([z.boolean(), z.object({}).passthrough()])\n    .describe(\n      'Retrieve public web data for grounding, powered by Google Search.'\n    )\n    .optional(),\n  thinkingConfig: z\n    .object({\n      includeThoughts: z\n        .boolean()\n        .describe(\n          'Indicates whether to include thoughts in the response.' +\n            'If true, thoughts are returned only when available.'\n        )\n        .optional(),\n      thinkingBudget: z\n        .number()\n        .min(0)\n        .max(24576)\n        .describe(\n          'The thinking budget parameter gives the model guidance on the ' +\n            'number of thinking tokens it can use when generating a response. ' +\n            'A greater number of tokens is typically associated with more detailed ' +\n            'thinking, which is needed for solving more complex tasks. ' +\n            'Setting the thinking budget to 0 disables thinking.'\n        )\n        .optional(),\n    })\n    .optional(),\n}).passthrough();\nexport type GeminiConfig = z.infer<typeof GeminiConfigSchema>;\n\nexport const GeminiGemmaConfigSchema = GeminiConfigSchema.extend({\n  temperature: z\n    .number()\n    .min(0.0)\n    .max(1.0)\n    .describe(\n      GenerationCommonConfigDescriptions.temperature +\n        ' The default value is 1.0.'\n    )\n    .optional(),\n}).passthrough();\n\nexport const GeminiTtsConfigSchema = GeminiConfigSchema.extend({\n  speechConfig: z\n    .object({\n      voiceConfig: VoiceConfigSchema.optional(),\n      multiSpeakerVoiceConfig: z\n        .object({\n          speakerVoiceConfigs: z\n            .array(\n              z\n                .object({\n                  speaker: z.string().describe('Name of the speaker to use'),\n                  voiceConfig: VoiceConfigSchema,\n                })\n                .describe(\n                  'Configuration for a single speaker in a multi speaker setup'\n                )\n                .passthrough()\n            )\n            .describe('Configuration for all the enabled speaker voices'),\n        })\n        .describe('Configuration for multi-speaker setup')\n        .passthrough()\n        .optional(),\n    })\n    .describe('Speech generation config')\n    .passthrough()\n    .optional(),\n}).passthrough();\n\nexport const gemini10Pro = modelRef({\n  name: 'googleai/gemini-1.0-pro',\n  info: {\n    label: 'Google AI - Gemini Pro',\n    versions: ['gemini-pro', 'gemini-1.0-pro-latest', 'gemini-1.0-pro-001'],\n    supports: {\n      multiturn: true,\n      media: false,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini15Pro = modelRef({\n  name: 'googleai/gemini-1.5-pro',\n  info: {\n    label: 'Google AI - Gemini 1.5 Pro',\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n    versions: [\n      'gemini-1.5-pro-latest',\n      'gemini-1.5-pro-001',\n      'gemini-1.5-pro-002',\n    ],\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini15Flash = modelRef({\n  name: 'googleai/gemini-1.5-flash',\n  info: {\n    label: 'Google AI - Gemini 1.5 Flash',\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n      // @ts-ignore\n      contextCache: true,\n    },\n    versions: [\n      'gemini-1.5-flash-latest',\n      'gemini-1.5-flash-001',\n      'gemini-1.5-flash-002',\n    ],\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini15Flash8b = modelRef({\n  name: 'googleai/gemini-1.5-flash-8b',\n  info: {\n    label: 'Google AI - Gemini 1.5 Flash',\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n    versions: ['gemini-1.5-flash-8b-latest', 'gemini-1.5-flash-8b-001'],\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini20Flash = modelRef({\n  name: 'googleai/gemini-2.0-flash',\n  info: {\n    label: 'Google AI - Gemini 2.0 Flash',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini20FlashExp = modelRef({\n  name: 'googleai/gemini-2.0-flash-exp',\n  info: {\n    label: 'Google AI - Gemini 2.0 Flash (Experimental)',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini20FlashLite = modelRef({\n  name: 'googleai/gemini-2.0-flash-lite',\n  info: {\n    label: 'Google AI - Gemini 2.0 Flash Lite',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini20ProExp0205 = modelRef({\n  name: 'googleai/gemini-2.0-pro-exp-02-05',\n  info: {\n    label: 'Google AI - Gemini 2.0 Pro Exp 02-05',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini25FlashPreview0417 = modelRef({\n  name: 'googleai/gemini-2.5-flash-preview-04-17',\n  info: {\n    label: 'Google AI - Gemini 2.5 Flash Preview 04-17',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini25FlashPreviewTts = modelRef({\n  name: 'googleai/gemini-2.5-flash-preview-tts',\n  info: {\n    label: 'Google AI - Gemini 2.5 Flash Preview TTS',\n    versions: [],\n    supports: {\n      multiturn: false,\n      media: false,\n      tools: false,\n      toolChoice: false,\n      systemRole: false,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiTtsConfigSchema,\n});\n\nexport const gemini25ProExp0325 = modelRef({\n  name: 'googleai/gemini-2.5-pro-exp-03-25',\n  info: {\n    label: 'Google AI - Gemini 2.5 Pro Exp 03-25',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini25ProPreview0325 = modelRef({\n  name: 'googleai/gemini-2.5-pro-preview-03-25',\n  info: {\n    label: 'Google AI - Gemini 2.5 Pro Preview 03-25',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini25ProPreviewTts = modelRef({\n  name: 'googleai/gemini-2.5-pro-preview-tts',\n  info: {\n    label: 'Google AI - Gemini 2.5 Pro Preview TTS',\n    versions: [],\n    supports: {\n      multiturn: false,\n      media: false,\n      tools: false,\n      toolChoice: false,\n      systemRole: false,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiTtsConfigSchema,\n});\n\nexport const gemini25Pro = modelRef({\n  name: 'googleai/gemini-2.5-pro',\n  info: {\n    label: 'Google AI - Gemini 2.5 Pro',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini25Flash = modelRef({\n  name: 'googleai/gemini-2.5-flash',\n  info: {\n    label: 'Google AI - Gemini 2.5 Flash',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemini25FlashLite = modelRef({\n  name: 'googleai/gemini-2.5-flash-lite',\n  info: {\n    label: 'Google AI - Gemini 2.5 Flash Lite',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiConfigSchema,\n});\n\nexport const gemma312bit = modelRef({\n  name: 'googleai/gemma-3-12b-it',\n  info: {\n    label: 'Google AI - Gemma 3 12B',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiGemmaConfigSchema,\n});\n\nexport const gemma31bit = modelRef({\n  name: 'googleai/gemma-3-1b-it',\n  info: {\n    label: 'Google AI - Gemma 3 1B',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiGemmaConfigSchema,\n});\n\nexport const gemma327bit = modelRef({\n  name: 'googleai/gemma-3-27b-it',\n  info: {\n    label: 'Google AI - Gemma 3 27B',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiGemmaConfigSchema,\n});\n\nexport const gemma34bit = modelRef({\n  name: 'googleai/gemma-3-4b-it',\n  info: {\n    label: 'Google AI - Gemma 3 4B',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiGemmaConfigSchema,\n});\n\nexport const gemma3ne4bit = modelRef({\n  name: 'googleai/gemma-3n-e4b-it',\n  info: {\n    label: 'Google AI - Gemma 3n E4B',\n    versions: [],\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n  configSchema: GeminiGemmaConfigSchema,\n});\n\nexport const SUPPORTED_GEMINI_MODELS = {\n  'gemini-1.5-pro': gemini15Pro,\n  'gemini-1.5-flash': gemini15Flash,\n  'gemini-1.5-flash-8b': gemini15Flash8b,\n  'gemini-2.0-pro-exp-02-05': gemini20ProExp0205,\n  'gemini-2.0-flash': gemini20Flash,\n  'gemini-2.0-flash-lite': gemini20FlashLite,\n  'gemini-2.0-flash-exp': gemini20FlashExp,\n  'gemini-2.5-pro-exp-03-25': gemini25ProExp0325,\n  'gemini-2.5-pro-preview-03-25': gemini25ProPreview0325,\n  'gemini-2.5-pro-preview-tts': gemini25ProPreviewTts,\n  'gemini-2.5-flash-preview-04-17': gemini25FlashPreview0417,\n  'gemini-2.5-flash-preview-tts': gemini25FlashPreviewTts,\n  'gemini-2.5-flash': gemini25Flash,\n  'gemini-2.5-flash-lite': gemini25FlashLite,\n  'gemini-2.5-pro': gemini25Pro,\n  'gemma-3-12b-it': gemma312bit,\n  'gemma-3-1b-it': gemma31bit,\n  'gemma-3-27b-it': gemma327bit,\n  'gemma-3-4b-it': gemma34bit,\n  'gemma-3n-e4b-it': gemma3ne4bit,\n};\n\nexport const GENERIC_GEMINI_MODEL = modelRef({\n  name: 'googleai/gemini',\n  configSchema: GeminiConfigSchema,\n  info: {\n    label: 'Google Gemini',\n    supports: {\n      multiturn: true,\n      media: true,\n      tools: true,\n      toolChoice: true,\n      systemRole: true,\n      constrained: 'no-tools',\n    },\n  },\n});\n\nfunction longestMatchingPrefix(version: string, potentialMatches: string[]) {\n  return potentialMatches\n    .filter((p) => version.startsWith(p))\n    .reduce(\n      (longest, current) =>\n        current.length > longest.length ? current : longest,\n      ''\n    );\n}\n\n/**\n * Known model names, to allow code completion for convenience. Allows other model names.\n */\nexport type GeminiVersionString =\n  | keyof typeof SUPPORTED_GEMINI_MODELS\n  | (string & {});\n\n/**\n * Returns a reference to a model that can be used in generate calls.\n *\n * ```js\n * await ai.generate({\n *   prompt: 'hi',\n *   model: gemini('gemini-1.5-flash')\n * });\n * ```\n */\nexport function gemini(\n  version: GeminiVersionString,\n  options: GeminiConfig = {}\n): ModelReference<typeof GeminiConfigSchema> {\n  const nearestModel = nearestGeminiModelRef(version);\n  return modelRef({\n    name: `googleai/${version}`,\n    config: options,\n    configSchema: GeminiConfigSchema,\n    info: {\n      ...nearestModel.info,\n      // If exact suffix match for a known model, use its label, otherwise create a new label\n      label: nearestModel.name.endsWith(version)\n        ? nearestModel.info?.label\n        : `Google AI - ${version}`,\n    },\n  });\n}\n\nfunction nearestGeminiModelRef(\n  version: GeminiVersionString,\n  options: GeminiConfig = {}\n): ModelReference<typeof GeminiConfigSchema> {\n  const matchingKey = longestMatchingPrefix(\n    version,\n    Object.keys(SUPPORTED_GEMINI_MODELS)\n  );\n  if (matchingKey) {\n    return SUPPORTED_GEMINI_MODELS[matchingKey].withConfig({\n      ...options,\n      version,\n    });\n  }\n\n  return GENERIC_GEMINI_MODEL.withConfig({ ...options, version });\n}\n\nfunction toGeminiRole(\n  role: MessageData['role'],\n  model?: ModelReference<z.ZodTypeAny>\n): string {\n  switch (role) {\n    case 'user':\n      return 'user';\n    case 'model':\n      return 'model';\n    case 'system':\n      if (model?.info?.supports?.systemRole) {\n        // We should have already pulled out the supported system messages,\n        // anything remaining is unsupported; throw an error.\n        throw new Error(\n          'system role is only supported for a single message in the first position'\n        );\n      } else {\n        throw new Error('system role is not supported');\n      }\n    case 'tool':\n      return 'function';\n    default:\n      return 'user';\n  }\n}\n\nfunction convertSchemaProperty(property) {\n  if (!property || !property.type) {\n    return undefined;\n  }\n  const baseSchema = {} as Schema;\n  if (property.description) {\n    baseSchema.description = property.description;\n  }\n  if (property.enum) {\n    baseSchema.type = SchemaType.STRING;\n    // supported in API but not in SDK\n    (baseSchema as any).enum = property.enum;\n  }\n  if (property.nullable) {\n    baseSchema.nullable = property.nullable;\n  }\n  let propertyType;\n  // nullable schema can ALSO be defined as, for example, type=['string','null']\n  if (Array.isArray(property.type)) {\n    const types = property.type as string[];\n    if (types.includes('null')) {\n      baseSchema.nullable = true;\n    }\n    // grab the type that's not `null`\n    propertyType = types.find((t) => t !== 'null');\n  } else {\n    propertyType = property.type;\n  }\n  if (propertyType === 'object') {\n    const nestedProperties = {};\n    Object.keys(property.properties ?? {}).forEach((key) => {\n      nestedProperties[key] = convertSchemaProperty(property.properties[key]);\n    });\n    return {\n      ...baseSchema,\n      type: SchemaType.OBJECT,\n      properties: nestedProperties,\n      required: property.required,\n    };\n  } else if (propertyType === 'array') {\n    return {\n      ...baseSchema,\n      type: SchemaType.ARRAY,\n      items: convertSchemaProperty(property.items),\n    };\n  } else {\n    const schemaType = SchemaType[propertyType.toUpperCase()] as SchemaType;\n    if (!schemaType) {\n      throw new GenkitError({\n        status: 'INVALID_ARGUMENT',\n        message: `Unsupported property type ${propertyType.toUpperCase()}`,\n      });\n    }\n    return {\n      ...baseSchema,\n      type: schemaType,\n    };\n  }\n}\n\n/** @hidden */\nexport function toGeminiTool(\n  tool: z.infer<typeof ToolDefinitionSchema>\n): FunctionDeclaration {\n  const declaration: FunctionDeclaration = {\n    name: tool.name.replace(/\\//g, '__'), // Gemini throws on '/' in tool name\n    description: tool.description,\n    parameters: convertSchemaProperty(tool.inputSchema),\n  };\n  return declaration;\n}\n\nfunction toInlineData(part: MediaPart): InlineDataPart {\n  const dataUrl = part.media.url;\n  const b64Data = dataUrl.substring(dataUrl.indexOf(',')! + 1);\n  const contentType =\n    part.media.contentType ||\n    dataUrl.substring(dataUrl.indexOf(':')! + 1, dataUrl.indexOf(';'));\n  return { inlineData: { mimeType: contentType, data: b64Data } };\n}\n\nfunction toFileData(part: MediaPart): FileDataPart {\n  if (!part.media.contentType)\n    throw new Error(\n      'Must supply a `contentType` when sending File URIs to Gemini.'\n    );\n  return {\n    fileData: { mimeType: part.media.contentType, fileUri: part.media.url },\n  };\n}\n\nfunction fromInlineData(inlinePart: InlineDataPart): MediaPart {\n  // Check if the required properties exist\n  if (\n    !inlinePart.inlineData ||\n    !inlinePart.inlineData.hasOwnProperty('mimeType') ||\n    !inlinePart.inlineData.hasOwnProperty('data')\n  ) {\n    throw new Error('Invalid InlineDataPart: missing required properties');\n  }\n  const { mimeType, data } = inlinePart.inlineData;\n  // Combine data and mimeType into a data URL\n  const dataUrl = `data:${mimeType};base64,${data}`;\n  return {\n    media: {\n      url: dataUrl,\n      contentType: mimeType,\n    },\n  };\n}\n\nfunction toFunctionCall(part: ToolRequestPart): FunctionCallPart {\n  if (!part?.toolRequest?.input) {\n    throw Error('Invalid ToolRequestPart: input was missing.');\n  }\n  return {\n    functionCall: {\n      name: part.toolRequest.name,\n      args: part.toolRequest.input,\n    },\n  };\n}\n\nfunction fromFunctionCall(\n  part: FunctionCallPart,\n  ref: string\n): ToolRequestPart {\n  if (!part.functionCall) {\n    throw Error('Invalid FunctionCallPart');\n  }\n  return {\n    toolRequest: {\n      name: part.functionCall.name,\n      input: part.functionCall.args,\n      ref,\n    },\n  };\n}\n\nfunction toFunctionResponse(part: ToolResponsePart): FunctionResponsePart {\n  if (!part?.toolResponse?.output) {\n    throw Error('Invalid ToolResponsePart: output was missing.');\n  }\n  return {\n    functionResponse: {\n      name: part.toolResponse.name,\n      response: {\n        name: part.toolResponse.name,\n        content: part.toolResponse.output,\n      },\n    },\n  };\n}\n\nfunction fromFunctionResponse(part: FunctionResponsePart): ToolResponsePart {\n  if (!part.functionResponse) {\n    throw new Error('Invalid FunctionResponsePart.');\n  }\n  return {\n    toolResponse: {\n      name: part.functionResponse.name.replace(/__/g, '/'), // restore slashes\n      output: part.functionResponse.response,\n    },\n  };\n}\n\nfunction fromExecutableCode(part: GeminiPart): Part {\n  if (!part.executableCode) {\n    throw new Error('Invalid GeminiPart: missing executableCode');\n  }\n  return {\n    custom: {\n      executableCode: {\n        language: part.executableCode.language,\n        code: part.executableCode.code,\n      },\n    },\n  };\n}\n\nfunction fromCodeExecutionResult(part: GeminiPart): Part {\n  if (!part.codeExecutionResult) {\n    throw new Error('Invalid GeminiPart: missing codeExecutionResult');\n  }\n  return {\n    custom: {\n      codeExecutionResult: {\n        outcome: part.codeExecutionResult.outcome,\n        output: part.codeExecutionResult.output,\n      },\n    },\n  };\n}\n\nfunction fromThought(part: {\n  thought: boolean;\n  text?: string;\n  thoughtSignature?: string;\n}): Part {\n  return {\n    reasoning: part.text || '',\n    metadata: { thoughtSignature: (part as any).thoughtSignature },\n  };\n}\n\nfunction toCustomPart(part: Part): GeminiPart {\n  if (!part.custom) {\n    throw new Error('Invalid GeminiPart: missing custom');\n  }\n  if (part.custom.codeExecutionResult) {\n    return { codeExecutionResult: part.custom.codeExecutionResult };\n  }\n  if (part.custom.executableCode) {\n    return { executableCode: part.custom.executableCode };\n  }\n  throw new Error('Unsupported Custom Part type');\n}\n\nfunction toThought(part: Part) {\n  const outPart: any = { thought: true };\n  if (part.metadata?.thoughtSignature)\n    outPart.thoughtSignature = part.metadata.thoughtSignature;\n  if (part.reasoning?.length) outPart.text = part.reasoning;\n  return outPart;\n}\n\nfunction toGeminiPart(part: Part): GeminiPart {\n  if (part.text !== undefined) return { text: part.text || ' ' };\n  if (part.media) {\n    if (part.media.url.startsWith('data:')) return toInlineData(part);\n    return toFileData(part);\n  }\n  if (part.toolRequest) return toFunctionCall(part);\n  if (part.toolResponse) return toFunctionResponse(part);\n  if (part.custom) return toCustomPart(part);\n  if (typeof part.reasoning === 'string') return toThought(part);\n  throw new Error('Unsupported Part type' + JSON.stringify(part));\n}\n\nfunction fromGeminiPart(\n  part: GeminiPart,\n  jsonMode: boolean,\n  ref: string\n): Part {\n  if ('thought' in part) return fromThought(part as any);\n  if (typeof part.text === 'string') return { text: part.text };\n  if (part.inlineData) return fromInlineData(part);\n  if (part.functionCall) return fromFunctionCall(part, ref);\n  if (part.functionResponse) return fromFunctionResponse(part);\n  if (part.executableCode) return fromExecutableCode(part);\n  if (part.codeExecutionResult) return fromCodeExecutionResult(part);\n  throw new Error('Unsupported GeminiPart type: ' + JSON.stringify(part));\n}\n\nexport function toGeminiMessage(\n  message: MessageData,\n  model?: ModelReference<z.ZodTypeAny>\n): GeminiMessage {\n  let sortedParts = message.content;\n  if (message.role === 'tool') {\n    sortedParts = [...message.content].sort((a, b) => {\n      const aRef = a.toolResponse?.ref;\n      const bRef = b.toolResponse?.ref;\n      if (!aRef && !bRef) return 0;\n      if (!aRef) return 1;\n      if (!bRef) return -1;\n      return Number.parseInt(aRef, 10) - Number.parseInt(bRef, 10);\n    });\n  }\n  return {\n    role: toGeminiRole(message.role, model),\n    parts: sortedParts.map(toGeminiPart),\n  };\n}\n\nexport function toGeminiSystemInstruction(message: MessageData): GeminiMessage {\n  return {\n    role: 'user',\n    parts: message.content.map(toGeminiPart),\n  };\n}\n\nfunction fromGeminiFinishReason(\n  reason: GeminiCandidate['finishReason']\n): CandidateData['finishReason'] {\n  if (!reason) return 'unknown';\n  switch (reason) {\n    case 'STOP':\n      return 'stop';\n    case 'MAX_TOKENS':\n      return 'length';\n    case 'SAFETY': // blocked for safety\n    case 'RECITATION': // blocked for reciting training data\n      return 'blocked';\n    default:\n      return 'unknown';\n  }\n}\n\nexport function fromGeminiCandidate(\n  candidate: GeminiCandidate,\n  jsonMode = false\n): CandidateData {\n  const parts = candidate.content?.parts || [];\n  const genkitCandidate: CandidateData = {\n    index: candidate.index || 0,\n    message: {\n      role: 'model',\n      content: parts.map((part, index) =>\n        fromGeminiPart(part, jsonMode, index.toString())\n      ),\n    },\n    finishReason: fromGeminiFinishReason(candidate.finishReason),\n    finishMessage: candidate.finishMessage,\n    custom: {\n      safetyRatings: candidate.safetyRatings,\n      citationMetadata: candidate.citationMetadata,\n    },\n  };\n\n  return genkitCandidate;\n}\nexport function cleanSchema(schema: JSONSchema): JSONSchema {\n  const out = structuredClone(schema);\n  for (const key in out) {\n    if (key === '$schema' || key === 'additionalProperties') {\n      delete out[key];\n      continue;\n    }\n    if (typeof out[key] === 'object') {\n      out[key] = cleanSchema(out[key]);\n    }\n    // Zod nullish() and picoschema optional fields will produce type `[\"string\", \"null\"]`\n    // which is not supported by the model API. Convert them to just `\"string\"`.\n    if (key === 'type' && Array.isArray(out[key])) {\n      // find the first that's not `null`.\n      out[key] = out[key].find((t) => t !== 'null');\n    }\n  }\n  return out;\n}\n\n/**\n * Defines a new GoogleAI model.\n */\nexport function defineGoogleAIModel({\n  ai,\n  name,\n  apiKey: apiKeyOption,\n  apiVersion,\n  baseUrl,\n  info,\n  defaultConfig,\n  debugTraces,\n}: {\n  ai: Genkit;\n  name: string;\n  apiKey?: string | false;\n  apiVersion?: string;\n  baseUrl?: string;\n  info?: ModelInfo;\n  defaultConfig?: GeminiConfig;\n  debugTraces?: boolean;\n}): ModelAction {\n  let apiKey: string | undefined;\n  // DO NOT infer API key from environment variable if plugin was configured with `{apiKey: false}`.\n  if (apiKeyOption !== false) {\n    apiKey = apiKeyOption || getApiKeyFromEnvVar();\n    if (!apiKey) {\n      throw new GenkitError({\n        status: 'FAILED_PRECONDITION',\n        message:\n          'Please pass in the API key or set the GEMINI_API_KEY or GOOGLE_API_KEY environment variable.\\n' +\n          'For more details see https://genkit.dev/docs/plugins/google-genai',\n      });\n    }\n  }\n\n  const apiModelName = name.startsWith('googleai/')\n    ? name.substring('googleai/'.length)\n    : name;\n\n  const model: ModelReference<z.ZodTypeAny> =\n    SUPPORTED_GEMINI_MODELS[apiModelName] ??\n    modelRef({\n      name: `googleai/${apiModelName}`,\n      info: {\n        label: `Google AI - ${apiModelName}`,\n        supports: {\n          multiturn: true,\n          media: true,\n          tools: true,\n          systemRole: true,\n          output: ['text', 'json'],\n        },\n        ...info,\n      },\n      configSchema: GeminiConfigSchema,\n    });\n\n  const middleware: ModelMiddleware[] = [];\n  if (model.info?.supports?.media) {\n    // the gemini api doesn't support downloading media from http(s)\n    middleware.push(\n      downloadRequestMedia({\n        maxBytes: 1024 * 1024 * 10,\n        // don't downlaod files that have been uploaded using the Files API\n        filter: (part) => {\n          try {\n            const url = new URL(part.media.url);\n            if (\n              // Gemini can handle these URLs\n              [\n                'generativelanguage.googleapis.com',\n                'www.youtube.com',\n                'youtube.com',\n                'youtu.be',\n              ].includes(url.hostname)\n            )\n              return false;\n          } catch {}\n          return true;\n        },\n      })\n    );\n  }\n\n  return ai.defineModel(\n    {\n      apiVersion: 'v2',\n      name: model.name,\n      ...model.info,\n      configSchema: model.configSchema,\n      use: middleware,\n    },\n    async (request, { streamingRequested, sendChunk, abortSignal }) => {\n      const options: RequestOptions = { apiClient: getGenkitClientHeader() };\n      if (apiVersion) {\n        options.apiVersion = apiVersion;\n      }\n      if (apiVersion) {\n        options.baseUrl = baseUrl;\n      }\n      const requestConfig: z.infer<typeof GeminiConfigSchema> = {\n        ...defaultConfig,\n        ...request.config,\n      };\n\n      // Make a copy so that modifying the request will not produce side-effects\n      const messages = [...request.messages];\n      if (messages.length === 0) throw new Error('No messages provided.');\n\n      // Gemini does not support messages with role system and instead expects\n      // systemInstructions to be provided as a separate input. The first\n      // message detected with role=system will be used for systemInstructions.\n      let systemInstruction: GeminiMessage | undefined = undefined;\n      if (model.info?.supports?.systemRole) {\n        const systemMessage = messages.find((m) => m.role === 'system');\n        if (systemMessage) {\n          messages.splice(messages.indexOf(systemMessage), 1);\n          systemInstruction = toGeminiSystemInstruction(systemMessage);\n        }\n      }\n\n      const tools: Tool[] = [];\n      if (request.tools?.length) {\n        tools.push({\n          functionDeclarations: request.tools.map(toGeminiTool),\n        });\n      }\n\n      const {\n        apiKey: apiKeyFromConfig,\n        safetySettings: safetySettingsFromConfig,\n        codeExecution: codeExecutionFromConfig,\n        version: versionFromConfig,\n        functionCallingConfig,\n        googleSearchRetrieval,\n        tools: toolsFromConfig,\n        ...restOfConfigOptions\n      } = requestConfig;\n\n      if (codeExecutionFromConfig) {\n        tools.push({\n          codeExecution:\n            request.config.codeExecution === true\n              ? {}\n              : request.config.codeExecution,\n        });\n      }\n\n      if (toolsFromConfig) {\n        tools.push(...(toolsFromConfig as any[]));\n      }\n\n      if (googleSearchRetrieval) {\n        tools.push({\n          googleSearch:\n            googleSearchRetrieval === true ? {} : googleSearchRetrieval,\n        } as GoogleSearchRetrievalTool);\n      }\n\n      let toolConfig: ToolConfig | undefined;\n      if (functionCallingConfig) {\n        toolConfig = {\n          functionCallingConfig: {\n            allowedFunctionNames: functionCallingConfig.allowedFunctionNames,\n            mode: toFunctionModeEnum(functionCallingConfig.mode),\n          },\n        };\n      } else if (request.toolChoice) {\n        toolConfig = {\n          functionCallingConfig: {\n            mode: toGeminiFunctionModeEnum(request.toolChoice),\n          },\n        };\n      }\n\n      // Cannot use tools with JSON mode\n      const jsonMode =\n        request.output?.format === 'json' ||\n        (request.output?.contentType === 'application/json' &&\n          tools.length === 0);\n\n      const generationConfig: GenerationConfig = {\n        ...restOfConfigOptions,\n        candidateCount: request.candidates || undefined,\n        responseMimeType: jsonMode ? 'application/json' : undefined,\n      };\n\n      if (request.output?.constrained && jsonMode) {\n        generationConfig.responseSchema = cleanSchema(request.output.schema);\n      }\n\n      const msg = toGeminiMessage(messages[messages.length - 1], model);\n\n      const fromJSONModeScopedGeminiCandidate = (\n        candidate: GeminiCandidate\n      ) => {\n        return fromGeminiCandidate(candidate, jsonMode);\n      };\n\n      const chatRequest: StartChatParams = {\n        systemInstruction,\n        generationConfig,\n        tools: tools.length ? tools : undefined,\n        toolConfig,\n        history: messages\n          .slice(0, -1)\n          .map((message) => toGeminiMessage(message, model)),\n        safetySettings: safetySettingsFromConfig,\n      } as StartChatParams;\n      const modelVersion = (versionFromConfig ||\n        model.version ||\n        apiModelName) as string;\n      const cacheConfigDetails = extractCacheConfig(request);\n\n      const { chatRequest: updatedChatRequest, cache } =\n        await handleCacheIfNeeded(\n          apiKey!,\n          request,\n          chatRequest,\n          modelVersion,\n          cacheConfigDetails\n        );\n\n      if (!apiKeyFromConfig && !apiKey) {\n        throw new GenkitError({\n          status: 'INVALID_ARGUMENT',\n          message:\n            'GoogleAI plugin was initialized with {apiKey: false} but no apiKey configuration was passed at call time.',\n        });\n      }\n      const client = new GoogleGenerativeAI(apiKeyFromConfig || apiKey!);\n      let genModel: GenerativeModel;\n\n      if (cache) {\n        genModel = client.getGenerativeModelFromCachedContent(\n          cache,\n          {\n            model: modelVersion,\n          },\n          options\n        );\n      } else {\n        genModel = client.getGenerativeModel(\n          {\n            model: modelVersion,\n          },\n          options\n        );\n      }\n\n      const callGemini = async () => {\n        let response: GenerateContentResponse;\n\n        if (streamingRequested) {\n          const result = await genModel\n            .startChat(updatedChatRequest)\n            .sendMessageStream(msg.parts, { ...options, signal: abortSignal });\n\n          const chunks = [] as GenerateContentResponse[];\n          for await (const item of result.stream) {\n            chunks.push(item as GenerateContentResponse);\n            (item as GenerateContentResponse).candidates?.forEach(\n              (candidate) => {\n                const c = fromJSONModeScopedGeminiCandidate(candidate);\n                sendChunk({\n                  index: c.index,\n                  content: c.message.content,\n                });\n              }\n            );\n          }\n\n          response = aggregateResponses(chunks);\n        } else {\n          const result = await genModel\n            .startChat(updatedChatRequest)\n            .sendMessage(msg.parts, { ...options, signal: abortSignal });\n\n          response = result.response;\n        }\n\n        const candidates = response.candidates || [];\n        if (response.candidates?.['undefined']) {\n          candidates.push(response.candidates['undefined']);\n        }\n        if (!candidates.length) {\n          throw new GenkitError({\n            status: 'FAILED_PRECONDITION',\n            message: 'No valid candidates returned.',\n          });\n        }\n\n        const candidateData =\n          candidates.map(fromJSONModeScopedGeminiCandidate) || [];\n\n        const usageMetadata = response.usageMetadata as ExtendedUsageMetadata;\n\n        return {\n          candidates: candidateData,\n          custom: response,\n          usage: {\n            ...getBasicUsageStats(request.messages, candidateData),\n            inputTokens: usageMetadata?.promptTokenCount,\n            outputTokens: usageMetadata?.candidatesTokenCount,\n            thoughtsTokens: usageMetadata?.thoughtsTokenCount,\n            totalTokens: usageMetadata?.totalTokenCount,\n            cachedContentTokens: usageMetadata?.cachedContentTokenCount,\n          },\n        };\n      };\n\n      // If debugTraces is enable, we wrap the actual model call with a span, add raw\n      // API params as for input.\n      return debugTraces\n        ? await runInNewSpan(\n            ai.registry,\n            {\n              metadata: {\n                name: streamingRequested ? 'sendMessageStream' : 'sendMessage',\n              },\n            },\n            async (metadata) => {\n              metadata.input = {\n                sdk: '@google/generative-ai',\n                cache: cache,\n                model: genModel.model,\n                chatOptions: updatedChatRequest,\n                parts: msg.parts,\n                options,\n              };\n              const response = await callGemini();\n              metadata.output = response.custom;\n              return response;\n            }\n          )\n        : await callGemini();\n    }\n  );\n}\n\n/** Converts mode from the config, which follows Gemini naming convention. */\nfunction toFunctionModeEnum(\n  configEnum: string | undefined\n): FunctionCallingMode | undefined {\n  if (configEnum === undefined) {\n    return undefined;\n  }\n  switch (configEnum) {\n    case 'MODE_UNSPECIFIED': {\n      return FunctionCallingMode.MODE_UNSPECIFIED;\n    }\n    case 'ANY': {\n      return FunctionCallingMode.ANY;\n    }\n    case 'AUTO': {\n      return FunctionCallingMode.AUTO;\n    }\n    case 'NONE': {\n      return FunctionCallingMode.NONE;\n    }\n    default:\n      throw new Error(`unsupported function calling mode: ${configEnum}`);\n  }\n}\n\n/** Converts mode from genkit tool choice. */\nfunction toGeminiFunctionModeEnum(\n  genkitMode: 'auto' | 'required' | 'none'\n): FunctionCallingMode | undefined {\n  if (genkitMode === undefined) {\n    return undefined;\n  }\n  switch (genkitMode) {\n    case 'required': {\n      return FunctionCallingMode.ANY;\n    }\n    case 'auto': {\n      return FunctionCallingMode.AUTO;\n    }\n    case 'none': {\n      return FunctionCallingMode.NONE;\n    }\n    default:\n      throw new Error(`unsupported function calling mode: ${genkitMode}`);\n  }\n}\n\n/**\n * Aggregates an array of `GenerateContentResponse`s into a single GenerateContentResponse.\n *\n * This code is copy-pasted from https://github.com/google-gemini/deprecated-generative-ai-js/blob/8b14949a5e8f1f3dfc35c394ebf5b19e68f92a22/src/requests/stream-reader.ts#L153\n * with a small (but critical) bug fix.\n */\nexport function aggregateResponses(\n  responses: GenerateContentResponse[]\n): GenerateContentResponse {\n  const lastResponse = responses[responses.length - 1];\n  const aggregatedResponse: GenerateContentResponse = {\n    promptFeedback: lastResponse?.promptFeedback,\n  };\n  for (const response of responses) {\n    if (response.candidates) {\n      let candidateIndex = 0;\n      for (const candidate of response.candidates) {\n        if (!aggregatedResponse.candidates) {\n          aggregatedResponse.candidates = [];\n        }\n        if (!aggregatedResponse.candidates[candidateIndex]) {\n          aggregatedResponse.candidates[candidateIndex] = {\n            index: candidateIndex,\n          } as GenerateContentCandidate;\n        }\n        // Keep overwriting, the last one will be final\n        aggregatedResponse.candidates[candidateIndex].citationMetadata =\n          candidate.citationMetadata;\n        aggregatedResponse.candidates[candidateIndex].groundingMetadata =\n          candidate.groundingMetadata;\n        aggregatedResponse.candidates[candidateIndex].finishReason =\n          candidate.finishReason;\n        aggregatedResponse.candidates[candidateIndex].finishMessage =\n          candidate.finishMessage;\n        aggregatedResponse.candidates[candidateIndex].safetyRatings =\n          candidate.safetyRatings;\n\n        /**\n         * Candidates should always have content and parts, but this handles\n         * possible malformed responses.\n         */\n        if (candidate.content && candidate.content.parts) {\n          if (!aggregatedResponse.candidates[candidateIndex].content) {\n            aggregatedResponse.candidates[candidateIndex].content = {\n              role: candidate.content.role || 'user',\n              parts: [],\n            };\n          }\n          for (const part of candidate.content.parts) {\n            const newPart: Partial<GeminiPart> = {};\n            if (part.text) {\n              newPart.text = part.text;\n            }\n            if ((part as any).thought) {\n              (newPart as any).thought = (part as any).thought;\n            }\n            if ((part as any).thoughtSignature) {\n              (newPart as any).thoughtSignature = (\n                part as any\n              ).thoughtSignature;\n            }\n            if (part.functionCall) {\n              newPart.functionCall = part.functionCall;\n            }\n            if (part.executableCode) {\n              newPart.executableCode = part.executableCode;\n            }\n            if (part.codeExecutionResult) {\n              newPart.codeExecutionResult = part.codeExecutionResult;\n            }\n            if (Object.keys(newPart).length === 0) {\n              newPart.text = '';\n            }\n            aggregatedResponse.candidates[candidateIndex].content.parts.push(\n              newPart as GeminiPart\n            );\n          }\n        }\n      }\n      candidateIndex++;\n    }\n    if (response.usageMetadata) {\n      aggregatedResponse.usageMetadata = response.usageMetadata;\n    }\n  }\n  return aggregatedResponse;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,iBAAA,CAAA;AAAA,SAAA,gBAAA;IAAA,sBAAA,IAAA;IAAA,oBAAA,IAAA;IAAA,yBAAA,IAAA;IAAA,uBAAA,IAAA;IAAA,yBAAA,IAAA;IAAA,oBAAA,IAAA;IAAA,aAAA,IAAA;IAAA,qBAAA,IAAA;IAAA,qBAAA,IAAA;IAAA,QAAA,IAAA;IAAA,aAAA,IAAA;IAAA,eAAA,IAAA;IAAA,iBAAA,IAAA;IAAA,aAAA,IAAA;IAAA,eAAA,IAAA;IAAA,kBAAA,IAAA;IAAA,mBAAA,IAAA;IAAA,oBAAA,IAAA;IAAA,eAAA,IAAA;IAAA,mBAAA,IAAA;IAAA,0BAAA,IAAA;IAAA,yBAAA,IAAA;IAAA,aAAA,IAAA;IAAA,oBAAA,IAAA;IAAA,wBAAA,IAAA;IAAA,uBAAA,IAAA;IAAA,aAAA,IAAA;IAAA,YAAA,IAAA;IAAA,aAAA,IAAA;IAAA,YAAA,IAAA;IAAA,cAAA,IAAA;IAAA,iBAAA,IAAA;IAAA,2BAAA,IAAA;IAAA,cAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAgBA,IAAA,uBAuBO;AACP,IAAA,gBAA6D;AAC7D,IAAA,eAgBO;AACP,IAAA,oBAAqC;AACrC,IAAA,iBAA6B;AAC7B,IAAA,gBAA2D;AAC3D,IAAA,yBAAoC;AACpC,IAAA,eAAmC;AAYnC,MAAM,uBAAuB,cAAA,CAAA,CAAE,MAAA,CAAO;IACpC,UAAU,cAAA,CAAA,CAAE,IAAA,CAAK;QACf;QACA;QACA;QACA;QACA;QACA;KACD;IACD,WAAW,cAAA,CAAA,CAAE,IAAA,CAAK;QAChB;QACA;QACA;QACA;KACD;AACH,CAAC;AAED,MAAM,oBAAoB,cAAA,CAAA,CACvB,MAAA,CAAO;IACN,qBAAqB,cAAA,CAAA,CAClB,MAAA,CAAO;QAAA,6EAAA;QAAA,sBAAA;QAGN,WAAW,cAAA,CAAA,CACR,KAAA,CAAM;YACL,cAAA,CAAA,CAAE,IAAA,CAAK;gBACL;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;aACD;YAAA,iCAAA;YAED,cAAA,CAAA,CAAE,MAAA,CAAO;SACV,EACA,QAAA,CAAS,iCAAiC,EAC1C,QAAA,CAAS;IACd,CAAC,EACA,QAAA,CAAS,+CAA+C,EACxD,WAAA,CAAY,EACZ,QAAA,CAAS;AACd,CAAC,EACA,QAAA,CAAS,oCAAoC,EAC7C,WAAA,CAAY;AAER,MAAM,qBAAqB,aAAA,4BAAA,CAA6B,MAAA,CAAO;IACpE,aAAa,cAAA,CAAA,CACV,MAAA,CAAO,EACP,GAAA,CAAI,CAAC,EACL,GAAA,CAAI,CAAC,EACL,QAAA,CACC,aAAA,kCAAA,CAAmC,WAAA,GACjC,8BAEH,QAAA,CAAS;IACZ,MAAM,cAAA,CAAA,CACH,MAAA,CAAO,EACP,GAAA,CAAI,CAAC,EACL,GAAA,CAAI,CAAC,EACL,QAAA,CACC,aAAA,kCAAA,CAAmC,IAAA,GAAO,+BAE3C,QAAA,CAAS;IACZ,QAAQ,cAAA,CAAA,CACL,MAAA,CAAO,EACP,QAAA,CAAS,wDAAwD,EACjE,QAAA,CAAS;IACZ,gBAAgB,cAAA,CAAA,CACb,KAAA,CAAM,oBAAoB,EAC1B,QAAA,CACC,qIAGD,QAAA,CAAS;IACZ,eAAe,cAAA,CAAA,CACZ,KAAA,CAAM;QAAC,cAAA,CAAA,CAAE,OAAA,CAAQ;QAAG,cAAA,CAAA,CAAE,MAAA,CAAO,CAAC,CAAC,EAAE,MAAA,CAAO,CAAC;KAAC,EAC1C,QAAA,CAAS,6CAA6C,EACtD,QAAA,CAAS;IACZ,cAAc,cAAA,CAAA,CACX,OAAA,CAAQ,EACR,QAAA,CACC,0GAGD,QAAA,CAAS;IACZ,uBAAuB,cAAA,CAAA,CACpB,MAAA,CAAO;QACN,MAAM,cAAA,CAAA,CAAE,IAAA,CAAK;YAAC;YAAoB;YAAQ;YAAO,MAAM;SAAC,EAAE,QAAA,CAAS;QACnE,sBAAsB,cAAA,CAAA,CAAE,KAAA,CAAM,cAAA,CAAA,CAAE,MAAA,CAAO,CAAC,EAAE,QAAA,CAAS;IACrD,CAAC,EACA,QAAA,CACC,gZAOD,QAAA,CAAS;IACZ,oBAAoB,cAAA,CAAA,CACjB,KAAA,CAAM,cAAA,CAAA,CAAE,IAAA,CAAK;QAAC;QAAQ;QAAS,OAAO;KAAC,CAAC,EACxC,QAAA,CACC,sGAGD,QAAA,CAAS;IACZ,uBAAuB,cAAA,CAAA,CACpB,KAAA,CAAM;QAAC,cAAA,CAAA,CAAE,OAAA,CAAQ;QAAG,cAAA,CAAA,CAAE,MAAA,CAAO,CAAC,CAAC,EAAE,WAAA,CAAY,CAAC;KAAC,EAC/C,QAAA,CACC,qEAED,QAAA,CAAS;IACZ,gBAAgB,cAAA,CAAA,CACb,MAAA,CAAO;QACN,iBAAiB,cAAA,CAAA,CACd,OAAA,CAAQ,EACR,QAAA,CACC,6GAGD,QAAA,CAAS;QACZ,gBAAgB,cAAA,CAAA,CACb,MAAA,CAAO,EACP,GAAA,CAAI,CAAC,EACL,GAAA,CAAI,KAAK,EACT,QAAA,CACC,sTAMD,QAAA,CAAS;IACd,CAAC,EACA,QAAA,CAAS;AACd,CAAC,EAAE,WAAA,CAAY;AAGR,MAAM,0BAA0B,mBAAmB,MAAA,CAAO;IAC/D,aAAa,cAAA,CAAA,CACV,MAAA,CAAO,EACP,GAAA,CAAI,CAAG,EACP,GAAA,CAAI,CAAG,EACP,QAAA,CACC,aAAA,kCAAA,CAAmC,WAAA,GACjC,8BAEH,QAAA,CAAS;AACd,CAAC,EAAE,WAAA,CAAY;AAER,MAAM,wBAAwB,mBAAmB,MAAA,CAAO;IAC7D,cAAc,cAAA,CAAA,CACX,MAAA,CAAO;QACN,aAAa,kBAAkB,QAAA,CAAS;QACxC,yBAAyB,cAAA,CAAA,CACtB,MAAA,CAAO;YACN,qBAAqB,cAAA,CAAA,CAClB,KAAA,CACC,cAAA,CAAA,CACG,MAAA,CAAO;gBACN,SAAS,cAAA,CAAA,CAAE,MAAA,CAAO,EAAE,QAAA,CAAS,4BAA4B;gBACzD,aAAa;YACf,CAAC,EACA,QAAA,CACC,+DAED,WAAA,CAAY,GAEhB,QAAA,CAAS,kDAAkD;QAChE,CAAC,EACA,QAAA,CAAS,uCAAuC,EAChD,WAAA,CAAY,EACZ,QAAA,CAAS;IACd,CAAC,EACA,QAAA,CAAS,0BAA0B,EACnC,WAAA,CAAY,EACZ,QAAA,CAAS;AACd,CAAC,EAAE,WAAA,CAAY;AAER,MAAM,cAAA,CAAA,GAAc,aAAA,QAAA,EAAS;IAClC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU;YAAC;YAAc;YAAyB,oBAAoB;SAAA;QACtE,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,cAAA,CAAA,GAAc,aAAA,QAAA,EAAS;IAClC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;QACA,UAAU;YACR;YACA;YACA;SACF;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,gBAAA,CAAA,GAAgB,aAAA,QAAA,EAAS;IACpC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;YAAA,aAAA;YAEb,cAAc;QAChB;QACA,UAAU;YACR;YACA;YACA;SACF;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,kBAAA,CAAA,GAAkB,aAAA,QAAA,EAAS;IACtC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;QACA,UAAU;YAAC;YAA8B,yBAAyB;SAAA;IACpE;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,gBAAA,CAAA,GAAgB,aAAA,QAAA,EAAS;IACpC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,mBAAA,CAAA,GAAmB,aAAA,QAAA,EAAS;IACvC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,oBAAA,CAAA,GAAoB,aAAA,QAAA,EAAS;IACxC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,qBAAA,CAAA,GAAqB,aAAA,QAAA,EAAS;IACzC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,2BAAA,CAAA,GAA2B,aAAA,QAAA,EAAS;IAC/C,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,0BAAA,CAAA,GAA0B,aAAA,QAAA,EAAS;IAC9C,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,qBAAA,CAAA,GAAqB,aAAA,QAAA,EAAS;IACzC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,yBAAA,CAAA,GAAyB,aAAA,QAAA,EAAS;IAC7C,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,wBAAA,CAAA,GAAwB,aAAA,QAAA,EAAS;IAC5C,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,cAAA,CAAA,GAAc,aAAA,QAAA,EAAS;IAClC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,gBAAA,CAAA,GAAgB,aAAA,QAAA,EAAS;IACpC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,oBAAA,CAAA,GAAoB,aAAA,QAAA,EAAS;IACxC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,cAAA,CAAA,GAAc,aAAA,QAAA,EAAS;IAClC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,aAAA,CAAA,GAAa,aAAA,QAAA,EAAS;IACjC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,cAAA,CAAA,GAAc,aAAA,QAAA,EAAS;IAClC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,aAAA,CAAA,GAAa,aAAA,QAAA,EAAS;IACjC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,eAAA,CAAA,GAAe,aAAA,QAAA,EAAS;IACnC,MAAM;IACN,MAAM;QACJ,OAAO;QACP,UAAU,CAAC,CAAA;QACX,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;IACA,cAAc;AAChB,CAAC;AAEM,MAAM,0BAA0B;IACrC,kBAAkB;IAClB,oBAAoB;IACpB,uBAAuB;IACvB,4BAA4B;IAC5B,oBAAoB;IACpB,yBAAyB;IACzB,wBAAwB;IACxB,4BAA4B;IAC5B,gCAAgC;IAChC,8BAA8B;IAC9B,kCAAkC;IAClC,gCAAgC;IAChC,oBAAoB;IACpB,yBAAyB;IACzB,kBAAkB;IAClB,kBAAkB;IAClB,iBAAiB;IACjB,kBAAkB;IAClB,iBAAiB;IACjB,mBAAmB;AACrB;AAEO,MAAM,uBAAA,CAAA,GAAuB,aAAA,QAAA,EAAS;IAC3C,MAAM;IACN,cAAc;IACd,MAAM;QACJ,OAAO;QACP,UAAU;YACR,WAAW;YACX,OAAO;YACP,OAAO;YACP,YAAY;YACZ,YAAY;YACZ,aAAa;QACf;IACF;AACF,CAAC;AAED,SAAS,sBAAsB,OAAA,EAAiB,gBAAA,EAA4B;IAC1E,OAAO,iBACJ,MAAA,CAAO,CAAC,IAAM,QAAQ,UAAA,CAAW,CAAC,CAAC,EACnC,MAAA,CACC,CAAC,SAAS,UACR,QAAQ,MAAA,GAAS,QAAQ,MAAA,GAAS,UAAU,SAC9C;AAEN;AAmBO,SAAS,OACd,OAAA,EACA,UAAwB,CAAC,CAAA,EACkB;IAC3C,MAAM,eAAe,sBAAsB,OAAO;IAClD,OAAA,CAAA,GAAO,aAAA,QAAA,EAAS;QACd,MAAM,CAAA,SAAA,EAAY,OAAO,EAAA;QACzB,QAAQ;QACR,cAAc;QACd,MAAM;YACJ,GAAG,aAAa,IAAA;YAAA,uFAAA;YAEhB,OAAO,aAAa,IAAA,CAAK,QAAA,CAAS,OAAO,IACrC,aAAa,IAAA,EAAM,QACnB,CAAA,YAAA,EAAe,OAAO,EAAA;QAC5B;IACF,CAAC;AACH;AAEA,SAAS,sBACP,OAAA,EACA,UAAwB,CAAC,CAAA,EACkB;IAC3C,MAAM,cAAc,sBAClB,SACA,OAAO,IAAA,CAAK,uBAAuB;IAErC,IAAI,aAAa;QACf,OAAO,uBAAA,CAAwB,WAAW,CAAA,CAAE,UAAA,CAAW;YACrD,GAAG,OAAA;YACH;QACF,CAAC;IACH;IAEA,OAAO,qBAAqB,UAAA,CAAW;QAAE,GAAG,OAAA;QAAS;IAAQ,CAAC;AAChE;AAEA,SAAS,aACP,IAAA,EACA,KAAA,EACQ;IACR,OAAQ,MAAM;QACZ,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,IAAI,OAAO,MAAM,UAAU,YAAY;gBAGrC,MAAM,IAAI,MACR;YAEJ,OAAO;gBACL,MAAM,IAAI,MAAM,8BAA8B;YAChD;QACF,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AAEA,SAAS,sBAAsB,QAAA,EAAU;IACvC,IAAI,CAAC,YAAY,CAAC,SAAS,IAAA,EAAM;QAC/B,OAAO,KAAA;IACT;IACA,MAAM,aAAa,CAAC;IACpB,IAAI,SAAS,WAAA,EAAa;QACxB,WAAW,WAAA,GAAc,SAAS,WAAA;IACpC;IACA,IAAI,SAAS,IAAA,EAAM;QACjB,WAAW,IAAA,GAAO,qBAAA,UAAA,CAAW,MAAA;QAE5B,WAAmB,IAAA,GAAO,SAAS,IAAA;IACtC;IACA,IAAI,SAAS,QAAA,EAAU;QACrB,WAAW,QAAA,GAAW,SAAS,QAAA;IACjC;IACA,IAAI;IAEJ,IAAI,MAAM,OAAA,CAAQ,SAAS,IAAI,GAAG;QAChC,MAAM,QAAQ,SAAS,IAAA;QACvB,IAAI,MAAM,QAAA,CAAS,MAAM,GAAG;YAC1B,WAAW,QAAA,GAAW;QACxB;QAEA,eAAe,MAAM,IAAA,CAAK,CAAC,IAAM,MAAM,MAAM;IAC/C,OAAO;QACL,eAAe,SAAS,IAAA;IAC1B;IACA,IAAI,iBAAiB,UAAU;QAC7B,MAAM,mBAAmB,CAAC;QAC1B,OAAO,IAAA,CAAK,SAAS,UAAA,IAAc,CAAC,CAAC,EAAE,OAAA,CAAQ,CAAC,QAAQ;YACtD,gBAAA,CAAiB,GAAG,CAAA,GAAI,sBAAsB,SAAS,UAAA,CAAW,GAAG,CAAC;QACxE,CAAC;QACD,OAAO;YACL,GAAG,UAAA;YACH,MAAM,qBAAA,UAAA,CAAW,MAAA;YACjB,YAAY;YACZ,UAAU,SAAS,QAAA;QACrB;IACF,OAAA,IAAW,iBAAiB,SAAS;QACnC,OAAO;YACL,GAAG,UAAA;YACH,MAAM,qBAAA,UAAA,CAAW,KAAA;YACjB,OAAO,sBAAsB,SAAS,KAAK;QAC7C;IACF,OAAO;QACL,MAAM,aAAa,qBAAA,UAAA,CAAW,aAAa,WAAA,CAAY,CAAC,CAAA;QACxD,IAAI,CAAC,YAAY;YACf,MAAM,IAAI,cAAA,WAAA,CAAY;gBACpB,QAAQ;gBACR,SAAS,CAAA,0BAAA,EAA6B,aAAa,WAAA,CAAY,CAAC,EAAA;YAClE,CAAC;QACH;QACA,OAAO;YACL,GAAG,UAAA;YACH,MAAM;QACR;IACF;AACF;AAGO,SAAS,aACd,IAAA,EACqB;IACrB,MAAM,cAAmC;QACvC,MAAM,KAAK,IAAA,CAAK,OAAA,CAAQ,OAAO,IAAI;QAAA,oCAAA;QACnC,aAAa,KAAK,WAAA;QAClB,YAAY,sBAAsB,KAAK,WAAW;IACpD;IACA,OAAO;AACT;AAEA,SAAS,aAAa,IAAA,EAAiC;IACrD,MAAM,UAAU,KAAK,KAAA,CAAM,GAAA;IAC3B,MAAM,UAAU,QAAQ,SAAA,CAAU,QAAQ,OAAA,CAAQ,GAAG,IAAK,CAAC;IAC3D,MAAM,cACJ,KAAK,KAAA,CAAM,WAAA,IACX,QAAQ,SAAA,CAAU,QAAQ,OAAA,CAAQ,GAAG,IAAK,GAAG,QAAQ,OAAA,CAAQ,GAAG,CAAC;IACnE,OAAO;QAAE,YAAY;YAAE,UAAU;YAAa,MAAM;QAAQ;IAAE;AAChE;AAEA,SAAS,WAAW,IAAA,EAA+B;IACjD,IAAI,CAAC,KAAK,KAAA,CAAM,WAAA,EACd,MAAM,IAAI,MACR;IAEJ,OAAO;QACL,UAAU;YAAE,UAAU,KAAK,KAAA,CAAM,WAAA;YAAa,SAAS,KAAK,KAAA,CAAM,GAAA;QAAI;IACxE;AACF;AAEA,SAAS,eAAe,UAAA,EAAuC;IAE7D,IACE,CAAC,WAAW,UAAA,IACZ,CAAC,WAAW,UAAA,CAAW,cAAA,CAAe,UAAU,KAChD,CAAC,WAAW,UAAA,CAAW,cAAA,CAAe,MAAM,GAC5C;QACA,MAAM,IAAI,MAAM,qDAAqD;IACvE;IACA,MAAM,EAAE,QAAA,EAAU,IAAA,CAAK,CAAA,GAAI,WAAW,UAAA;IAEtC,MAAM,UAAU,CAAA,KAAA,EAAQ,QAAQ,CAAA,QAAA,EAAW,IAAI,EAAA;IAC/C,OAAO;QACL,OAAO;YACL,KAAK;YACL,aAAa;QACf;IACF;AACF;AAEA,SAAS,eAAe,IAAA,EAAyC;IAC/D,IAAI,CAAC,MAAM,aAAa,OAAO;QAC7B,MAAM,MAAM,6CAA6C;IAC3D;IACA,OAAO;QACL,cAAc;YACZ,MAAM,KAAK,WAAA,CAAY,IAAA;YACvB,MAAM,KAAK,WAAA,CAAY,KAAA;QACzB;IACF;AACF;AAEA,SAAS,iBACP,IAAA,EACA,GAAA,EACiB;IACjB,IAAI,CAAC,KAAK,YAAA,EAAc;QACtB,MAAM,MAAM,0BAA0B;IACxC;IACA,OAAO;QACL,aAAa;YACX,MAAM,KAAK,YAAA,CAAa,IAAA;YACxB,OAAO,KAAK,YAAA,CAAa,IAAA;YACzB;QACF;IACF;AACF;AAEA,SAAS,mBAAmB,IAAA,EAA8C;IACxE,IAAI,CAAC,MAAM,cAAc,QAAQ;QAC/B,MAAM,MAAM,+CAA+C;IAC7D;IACA,OAAO;QACL,kBAAkB;YAChB,MAAM,KAAK,YAAA,CAAa,IAAA;YACxB,UAAU;gBACR,MAAM,KAAK,YAAA,CAAa,IAAA;gBACxB,SAAS,KAAK,YAAA,CAAa,MAAA;YAC7B;QACF;IACF;AACF;AAEA,SAAS,qBAAqB,IAAA,EAA8C;IAC1E,IAAI,CAAC,KAAK,gBAAA,EAAkB;QAC1B,MAAM,IAAI,MAAM,+BAA+B;IACjD;IACA,OAAO;QACL,cAAc;YACZ,MAAM,KAAK,gBAAA,CAAiB,IAAA,CAAK,OAAA,CAAQ,OAAO,GAAG;YAAA,kBAAA;YACnD,QAAQ,KAAK,gBAAA,CAAiB,QAAA;QAChC;IACF;AACF;AAEA,SAAS,mBAAmB,IAAA,EAAwB;IAClD,IAAI,CAAC,KAAK,cAAA,EAAgB;QACxB,MAAM,IAAI,MAAM,4CAA4C;IAC9D;IACA,OAAO;QACL,QAAQ;YACN,gBAAgB;gBACd,UAAU,KAAK,cAAA,CAAe,QAAA;gBAC9B,MAAM,KAAK,cAAA,CAAe,IAAA;YAC5B;QACF;IACF;AACF;AAEA,SAAS,wBAAwB,IAAA,EAAwB;IACvD,IAAI,CAAC,KAAK,mBAAA,EAAqB;QAC7B,MAAM,IAAI,MAAM,iDAAiD;IACnE;IACA,OAAO;QACL,QAAQ;YACN,qBAAqB;gBACnB,SAAS,KAAK,mBAAA,CAAoB,OAAA;gBAClC,QAAQ,KAAK,mBAAA,CAAoB,MAAA;YACnC;QACF;IACF;AACF;AAEA,SAAS,YAAY,IAAA,EAIZ;IACP,OAAO;QACL,WAAW,KAAK,IAAA,IAAQ;QACxB,UAAU;YAAE,kBAAmB,KAAa,gBAAA;QAAiB;IAC/D;AACF;AAEA,SAAS,aAAa,IAAA,EAAwB;IAC5C,IAAI,CAAC,KAAK,MAAA,EAAQ;QAChB,MAAM,IAAI,MAAM,oCAAoC;IACtD;IACA,IAAI,KAAK,MAAA,CAAO,mBAAA,EAAqB;QACnC,OAAO;YAAE,qBAAqB,KAAK,MAAA,CAAO,mBAAA;QAAoB;IAChE;IACA,IAAI,KAAK,MAAA,CAAO,cAAA,EAAgB;QAC9B,OAAO;YAAE,gBAAgB,KAAK,MAAA,CAAO,cAAA;QAAe;IACtD;IACA,MAAM,IAAI,MAAM,8BAA8B;AAChD;AAEA,SAAS,UAAU,IAAA,EAAY;IAC7B,MAAM,UAAe;QAAE,SAAS;IAAK;IACrC,IAAI,KAAK,QAAA,EAAU,kBACjB,QAAQ,gBAAA,GAAmB,KAAK,QAAA,CAAS,gBAAA;IAC3C,IAAI,KAAK,SAAA,EAAW,OAAQ,CAAA,QAAQ,IAAA,GAAO,KAAK,SAAA;IAChD,OAAO;AACT;AAEA,SAAS,aAAa,IAAA,EAAwB;IAC5C,IAAI,KAAK,IAAA,KAAS,KAAA,EAAW,CAAA,OAAO;QAAE,MAAM,KAAK,IAAA,IAAQ;IAAI;IAC7D,IAAI,KAAK,KAAA,EAAO;QACd,IAAI,KAAK,KAAA,CAAM,GAAA,CAAI,UAAA,CAAW,OAAO,EAAG,CAAA,OAAO,aAAa,IAAI;QAChE,OAAO,WAAW,IAAI;IACxB;IACA,IAAI,KAAK,WAAA,CAAa,CAAA,OAAO,eAAe,IAAI;IAChD,IAAI,KAAK,YAAA,CAAc,CAAA,OAAO,mBAAmB,IAAI;IACrD,IAAI,KAAK,MAAA,CAAQ,CAAA,OAAO,aAAa,IAAI;IACzC,IAAI,OAAO,KAAK,SAAA,KAAc,SAAU,CAAA,OAAO,UAAU,IAAI;IAC7D,MAAM,IAAI,MAAM,0BAA0B,KAAK,SAAA,CAAU,IAAI,CAAC;AAChE;AAEA,SAAS,eACP,IAAA,EACA,QAAA,EACA,GAAA,EACM;IACN,IAAI,aAAa,KAAM,CAAA,OAAO,YAAY,IAAW;IACrD,IAAI,OAAO,KAAK,IAAA,KAAS,SAAU,CAAA,OAAO;QAAE,MAAM,KAAK,IAAA;IAAK;IAC5D,IAAI,KAAK,UAAA,CAAY,CAAA,OAAO,eAAe,IAAI;IAC/C,IAAI,KAAK,YAAA,CAAc,CAAA,OAAO,iBAAiB,MAAM,GAAG;IACxD,IAAI,KAAK,gBAAA,CAAkB,CAAA,OAAO,qBAAqB,IAAI;IAC3D,IAAI,KAAK,cAAA,CAAgB,CAAA,OAAO,mBAAmB,IAAI;IACvD,IAAI,KAAK,mBAAA,CAAqB,CAAA,OAAO,wBAAwB,IAAI;IACjE,MAAM,IAAI,MAAM,kCAAkC,KAAK,SAAA,CAAU,IAAI,CAAC;AACxE;AAEO,SAAS,gBACd,OAAA,EACA,KAAA,EACe;IACf,IAAI,cAAc,QAAQ,OAAA;IAC1B,IAAI,QAAQ,IAAA,KAAS,QAAQ;QAC3B,cAAc,CAAC;eAAG,QAAQ,OAAO;SAAA,CAAE,IAAA,CAAK,CAAC,GAAG,MAAM;YAChD,MAAM,OAAO,EAAE,YAAA,EAAc;YAC7B,MAAM,OAAO,EAAE,YAAA,EAAc;YAC7B,IAAI,CAAC,QAAQ,CAAC,KAAM,CAAA,OAAO;YAC3B,IAAI,CAAC,KAAM,CAAA,OAAO;YAClB,IAAI,CAAC,KAAM,CAAA,OAAO,CAAA;YAClB,OAAO,OAAO,QAAA,CAAS,MAAM,EAAE,IAAI,OAAO,QAAA,CAAS,MAAM,EAAE;QAC7D,CAAC;IACH;IACA,OAAO;QACL,MAAM,aAAa,QAAQ,IAAA,EAAM,KAAK;QACtC,OAAO,YAAY,GAAA,CAAI,YAAY;IACrC;AACF;AAEO,SAAS,0BAA0B,OAAA,EAAqC;IAC7E,OAAO;QACL,MAAM;QACN,OAAO,QAAQ,OAAA,CAAQ,GAAA,CAAI,YAAY;IACzC;AACF;AAEA,SAAS,uBACP,MAAA,EAC+B;IAC/B,IAAI,CAAC,OAAQ,CAAA,OAAO;IACpB,OAAQ,QAAQ;QACd,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;QAAA,qBAAA;QACL,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AAEO,SAAS,oBACd,SAAA,EACA,WAAW,KAAA,EACI;IACf,MAAM,QAAQ,UAAU,OAAA,EAAS,SAAS,CAAC,CAAA;IAC3C,MAAM,kBAAiC;QACrC,OAAO,UAAU,KAAA,IAAS;QAC1B,SAAS;YACP,MAAM;YACN,SAAS,MAAM,GAAA,CAAI,CAAC,MAAM,QACxB,eAAe,MAAM,UAAU,MAAM,QAAA,CAAS,CAAC;QAEnD;QACA,cAAc,uBAAuB,UAAU,YAAY;QAC3D,eAAe,UAAU,aAAA;QACzB,QAAQ;YACN,eAAe,UAAU,aAAA;YACzB,kBAAkB,UAAU,gBAAA;QAC9B;IACF;IAEA,OAAO;AACT;AACO,SAAS,YAAY,MAAA,EAAgC;IAC1D,MAAM,MAAM,gBAAgB,MAAM;IAClC,IAAA,MAAW,OAAO,IAAK;QACrB,IAAI,QAAQ,aAAa,QAAQ,wBAAwB;YACvD,OAAO,GAAA,CAAI,GAAG,CAAA;YACd;QACF;QACA,IAAI,OAAO,GAAA,CAAI,GAAG,CAAA,KAAM,UAAU;YAChC,GAAA,CAAI,GAAG,CAAA,GAAI,YAAY,GAAA,CAAI,GAAG,CAAC;QACjC;QAGA,IAAI,QAAQ,UAAU,MAAM,OAAA,CAAQ,GAAA,CAAI,GAAG,CAAC,GAAG;YAE7C,GAAA,CAAI,GAAG,CAAA,GAAI,GAAA,CAAI,GAAG,CAAA,CAAE,IAAA,CAAK,CAAC,IAAM,MAAM,MAAM;QAC9C;IACF;IACA,OAAO;AACT;AAKO,SAAS,oBAAoB,EAClC,EAAA,EACA,IAAA,EACA,QAAQ,YAAA,EACR,UAAA,EACA,OAAA,EACA,IAAA,EACA,aAAA,EACA,WAAA,EACF,EASgB;IACd,IAAI;IAEJ,IAAI,iBAAiB,OAAO;QAC1B,SAAS,gBAAA,CAAA,GAAgB,cAAA,mBAAA,EAAoB;QAC7C,IAAI,CAAC,QAAQ;YACX,MAAM,IAAI,cAAA,WAAA,CAAY;gBACpB,QAAQ;gBACR,SACE;YAEJ,CAAC;QACH;IACF;IAEA,MAAM,eAAe,KAAK,UAAA,CAAW,WAAW,IAC5C,KAAK,SAAA,CAAU,YAAY,MAAM,IACjC;IAEJ,MAAM,QACJ,uBAAA,CAAwB,YAAY,CAAA,IAAA,CAAA,GACpC,aAAA,QAAA,EAAS;QACP,MAAM,CAAA,SAAA,EAAY,YAAY,EAAA;QAC9B,MAAM;YACJ,OAAO,CAAA,YAAA,EAAe,YAAY,EAAA;YAClC,UAAU;gBACR,WAAW;gBACX,OAAO;gBACP,OAAO;gBACP,YAAY;gBACZ,QAAQ;oBAAC;oBAAQ,MAAM;iBAAA;YACzB;YACA,GAAG,IAAA;QACL;QACA,cAAc;IAChB,CAAC;IAEH,MAAM,aAAgC,CAAC,CAAA;IACvC,IAAI,MAAM,IAAA,EAAM,UAAU,OAAO;QAE/B,WAAW,IAAA,CAAA,CAAA,GACT,kBAAA,oBAAA,EAAqB;YACnB,UAAU,OAAO,OAAO;YAAA,mEAAA;YAExB,QAAQ,CAAC,SAAS;gBAChB,IAAI;oBACF,MAAM,MAAM,IAAI,IAAI,KAAK,KAAA,CAAM,GAAG;oBAClC,IAAA,+BAAA;oBAEE;wBACE;wBACA;wBACA;wBACA;qBACF,CAAE,QAAA,CAAS,IAAI,QAAQ,GAEvB,OAAO;gBACX,EAAA,OAAQ,CAAC;gBACT,OAAO;YACT;QACF,CAAC;IAEL;IAEA,OAAO,GAAG,WAAA,CACR;QACE,YAAY;QACZ,MAAM,MAAM,IAAA;QACZ,GAAG,MAAM,IAAA;QACT,cAAc,MAAM,YAAA;QACpB,KAAK;IACP,GACA,OAAO,SAAS,EAAE,kBAAA,EAAoB,SAAA,EAAW,WAAA,CAAY,CAAA,KAAM;QACjE,MAAM,UAA0B;YAAE,WAAA,CAAA,GAAW,cAAA,qBAAA,EAAsB;QAAE;QACrE,IAAI,YAAY;YACd,QAAQ,UAAA,GAAa;QACvB;QACA,IAAI,YAAY;YACd,QAAQ,OAAA,GAAU;QACpB;QACA,MAAM,gBAAoD;YACxD,GAAG,aAAA;YACH,GAAG,QAAQ,MAAA;QACb;QAGA,MAAM,WAAW,CAAC;eAAG,QAAQ,QAAQ;SAAA;QACrC,IAAI,SAAS,MAAA,KAAW,EAAG,CAAA,MAAM,IAAI,MAAM,uBAAuB;QAKlE,IAAI,oBAA+C,KAAA;QACnD,IAAI,MAAM,IAAA,EAAM,UAAU,YAAY;YACpC,MAAM,gBAAgB,SAAS,IAAA,CAAK,CAAC,IAAM,EAAE,IAAA,KAAS,QAAQ;YAC9D,IAAI,eAAe;gBACjB,SAAS,MAAA,CAAO,SAAS,OAAA,CAAQ,aAAa,GAAG,CAAC;gBAClD,oBAAoB,0BAA0B,aAAa;YAC7D;QACF;QAEA,MAAM,QAAgB,CAAC,CAAA;QACvB,IAAI,QAAQ,KAAA,EAAO,QAAQ;YACzB,MAAM,IAAA,CAAK;gBACT,sBAAsB,QAAQ,KAAA,CAAM,GAAA,CAAI,YAAY;YACtD,CAAC;QACH;QAEA,MAAM,EACJ,QAAQ,gBAAA,EACR,gBAAgB,wBAAA,EAChB,eAAe,uBAAA,EACf,SAAS,iBAAA,EACT,qBAAA,EACA,qBAAA,EACA,OAAO,eAAA,EACP,GAAG,qBACL,GAAI;QAEJ,IAAI,yBAAyB;YAC3B,MAAM,IAAA,CAAK;gBACT,eACE,QAAQ,MAAA,CAAO,aAAA,KAAkB,OAC7B,CAAC,IACD,QAAQ,MAAA,CAAO,aAAA;YACvB,CAAC;QACH;QAEA,IAAI,iBAAiB;YACnB,MAAM,IAAA,CAAK,GAAI,eAAyB;QAC1C;QAEA,IAAI,uBAAuB;YACzB,MAAM,IAAA,CAAK;gBACT,cACE,0BAA0B,OAAO,CAAC,IAAI;YAC1C,CAA8B;QAChC;QAEA,IAAI;QACJ,IAAI,uBAAuB;YACzB,aAAa;gBACX,uBAAuB;oBACrB,sBAAsB,sBAAsB,oBAAA;oBAC5C,MAAM,mBAAmB,sBAAsB,IAAI;gBACrD;YACF;QACF,OAAA,IAAW,QAAQ,UAAA,EAAY;YAC7B,aAAa;gBACX,uBAAuB;oBACrB,MAAM,yBAAyB,QAAQ,UAAU;gBACnD;YACF;QACF;QAGA,MAAM,WACJ,QAAQ,MAAA,EAAQ,WAAW,UAC1B,QAAQ,MAAA,EAAQ,gBAAgB,sBAC/B,MAAM,MAAA,KAAW;QAErB,MAAM,mBAAqC;YACzC,GAAG,mBAAA;YACH,gBAAgB,QAAQ,UAAA,IAAc,KAAA;YACtC,kBAAkB,WAAW,qBAAqB,KAAA;QACpD;QAEA,IAAI,QAAQ,MAAA,EAAQ,eAAe,UAAU;YAC3C,iBAAiB,cAAA,GAAiB,YAAY,QAAQ,MAAA,CAAO,MAAM;QACrE;QAEA,MAAM,MAAM,gBAAgB,QAAA,CAAS,SAAS,MAAA,GAAS,CAAC,CAAA,EAAG,KAAK;QAEhE,MAAM,oCAAoC,CACxC,cACG;YACH,OAAO,oBAAoB,WAAW,QAAQ;QAChD;QAEA,MAAM,cAA+B;YACnC;YACA;YACA,OAAO,MAAM,MAAA,GAAS,QAAQ,KAAA;YAC9B;YACA,SAAS,SACN,KAAA,CAAM,GAAG,CAAA,CAAE,EACX,GAAA,CAAI,CAAC,UAAY,gBAAgB,SAAS,KAAK,CAAC;YACnD,gBAAgB;QAClB;QACA,MAAM,eAAgB,qBACpB,MAAM,OAAA,IACN;QACF,MAAM,qBAAA,CAAA,GAAqB,aAAA,kBAAA,EAAmB,OAAO;QAErD,MAAM,EAAE,aAAa,kBAAA,EAAoB,KAAA,CAAM,CAAA,GAC7C,MAAA,CAAA,GAAM,uBAAA,mBAAA,EACJ,QACA,SACA,aACA,cACA;QAGJ,IAAI,CAAC,oBAAoB,CAAC,QAAQ;YAChC,MAAM,IAAI,cAAA,WAAA,CAAY;gBACpB,QAAQ;gBACR,SACE;YACJ,CAAC;QACH;QACA,MAAM,SAAS,IAAI,qBAAA,kBAAA,CAAmB,oBAAoB,MAAO;QACjE,IAAI;QAEJ,IAAI,OAAO;YACT,WAAW,OAAO,mCAAA,CAChB,OACA;gBACE,OAAO;YACT,GACA;QAEJ,OAAO;YACL,WAAW,OAAO,kBAAA,CAChB;gBACE,OAAO;YACT,GACA;QAEJ;QAEA,MAAM,aAAa,YAAY;YAC7B,IAAI;YAEJ,IAAI,oBAAoB;gBACtB,MAAM,SAAS,MAAM,SAClB,SAAA,CAAU,kBAAkB,EAC5B,iBAAA,CAAkB,IAAI,KAAA,EAAO;oBAAE,GAAG,OAAA;oBAAS,QAAQ;gBAAY,CAAC;gBAEnE,MAAM,SAAS,CAAC,CAAA;gBAChB,WAAA,MAAiB,QAAQ,OAAO,MAAA,CAAQ;oBACtC,OAAO,IAAA,CAAK,IAA+B;oBAC1C,KAAiC,UAAA,EAAY,QAC5C,CAAC,cAAc;wBACb,MAAM,IAAI,kCAAkC,SAAS;wBACrD,UAAU;4BACR,OAAO,EAAE,KAAA;4BACT,SAAS,EAAE,OAAA,CAAQ,OAAA;wBACrB,CAAC;oBACH;gBAEJ;gBAEA,WAAW,mBAAmB,MAAM;YACtC,OAAO;gBACL,MAAM,SAAS,MAAM,SAClB,SAAA,CAAU,kBAAkB,EAC5B,WAAA,CAAY,IAAI,KAAA,EAAO;oBAAE,GAAG,OAAA;oBAAS,QAAQ;gBAAY,CAAC;gBAE7D,WAAW,OAAO,QAAA;YACpB;YAEA,MAAM,aAAa,SAAS,UAAA,IAAc,CAAC,CAAA;YAC3C,IAAI,SAAS,UAAA,EAAA,CAAa,WAAW,CAAA,EAAG;gBACtC,WAAW,IAAA,CAAK,SAAS,UAAA,CAAW,WAAW,CAAC;YAClD;YACA,IAAI,CAAC,WAAW,MAAA,EAAQ;gBACtB,MAAM,IAAI,cAAA,WAAA,CAAY;oBACpB,QAAQ;oBACR,SAAS;gBACX,CAAC;YACH;YAEA,MAAM,gBACJ,WAAW,GAAA,CAAI,iCAAiC,KAAK,CAAC,CAAA;YAExD,MAAM,gBAAgB,SAAS,aAAA;YAE/B,OAAO;gBACL,YAAY;gBACZ,QAAQ;gBACR,OAAO;oBACL,GAAA,CAAA,GAAG,aAAA,kBAAA,EAAmB,QAAQ,QAAA,EAAU,aAAa,CAAA;oBACrD,aAAa,eAAe;oBAC5B,cAAc,eAAe;oBAC7B,gBAAgB,eAAe;oBAC/B,aAAa,eAAe;oBAC5B,qBAAqB,eAAe;gBACtC;YACF;QACF;QAIA,OAAO,cACH,MAAA,CAAA,GAAM,eAAA,YAAA,EACJ,GAAG,QAAA,EACH;YACE,UAAU;gBACR,MAAM,qBAAqB,sBAAsB;YACnD;QACF,GACA,OAAO,aAAa;YAClB,SAAS,KAAA,GAAQ;gBACf,KAAK;gBACL;gBACA,OAAO,SAAS,KAAA;gBAChB,aAAa;gBACb,OAAO,IAAI,KAAA;gBACX;YACF;YACA,MAAM,WAAW,MAAM,WAAW;YAClC,SAAS,MAAA,GAAS,SAAS,MAAA;YAC3B,OAAO;QACT,KAEF,MAAM,WAAW;IACvB;AAEJ;AAGA,SAAS,mBACP,UAAA,EACiC;IACjC,IAAI,eAAe,KAAA,GAAW;QAC5B,OAAO,KAAA;IACT;IACA,OAAQ,YAAY;QAClB,KAAK;YAAoB;gBACvB,OAAO,qBAAA,mBAAA,CAAoB,gBAAA;YAC7B;QACA,KAAK;YAAO;gBACV,OAAO,qBAAA,mBAAA,CAAoB,GAAA;YAC7B;QACA,KAAK;YAAQ;gBACX,OAAO,qBAAA,mBAAA,CAAoB,IAAA;YAC7B;QACA,KAAK;YAAQ;gBACX,OAAO,qBAAA,mBAAA,CAAoB,IAAA;YAC7B;QACA;YACE,MAAM,IAAI,MAAM,CAAA,mCAAA,EAAsC,UAAU,EAAE;IACtE;AACF;AAGA,SAAS,yBACP,UAAA,EACiC;IACjC,IAAI,eAAe,KAAA,GAAW;QAC5B,OAAO,KAAA;IACT;IACA,OAAQ,YAAY;QAClB,KAAK;YAAY;gBACf,OAAO,qBAAA,mBAAA,CAAoB,GAAA;YAC7B;QACA,KAAK;YAAQ;gBACX,OAAO,qBAAA,mBAAA,CAAoB,IAAA;YAC7B;QACA,KAAK;YAAQ;gBACX,OAAO,qBAAA,mBAAA,CAAoB,IAAA;YAC7B;QACA;YACE,MAAM,IAAI,MAAM,CAAA,mCAAA,EAAsC,UAAU,EAAE;IACtE;AACF;AAQO,SAAS,mBACd,SAAA,EACyB;IACzB,MAAM,eAAe,SAAA,CAAU,UAAU,MAAA,GAAS,CAAC,CAAA;IACnD,MAAM,qBAA8C;QAClD,gBAAgB,cAAc;IAChC;IACA,KAAA,MAAW,YAAY,UAAW;QAChC,IAAI,SAAS,UAAA,EAAY;YACvB,IAAI,iBAAiB;YACrB,KAAA,MAAW,aAAa,SAAS,UAAA,CAAY;gBAC3C,IAAI,CAAC,mBAAmB,UAAA,EAAY;oBAClC,mBAAmB,UAAA,GAAa,CAAC,CAAA;gBACnC;gBACA,IAAI,CAAC,mBAAmB,UAAA,CAAW,cAAc,CAAA,EAAG;oBAClD,mBAAmB,UAAA,CAAW,cAAc,CAAA,GAAI;wBAC9C,OAAO;oBACT;gBACF;gBAEA,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,gBAAA,GAC5C,UAAU,gBAAA;gBACZ,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,iBAAA,GAC5C,UAAU,iBAAA;gBACZ,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,YAAA,GAC5C,UAAU,YAAA;gBACZ,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,aAAA,GAC5C,UAAU,aAAA;gBACZ,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,aAAA,GAC5C,UAAU,aAAA;gBAMZ,IAAI,UAAU,OAAA,IAAW,UAAU,OAAA,CAAQ,KAAA,EAAO;oBAChD,IAAI,CAAC,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,OAAA,EAAS;wBAC1D,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,OAAA,GAAU;4BACtD,MAAM,UAAU,OAAA,CAAQ,IAAA,IAAQ;4BAChC,OAAO,CAAC,CAAA;wBACV;oBACF;oBACA,KAAA,MAAW,QAAQ,UAAU,OAAA,CAAQ,KAAA,CAAO;wBAC1C,MAAM,UAA+B,CAAC;wBACtC,IAAI,KAAK,IAAA,EAAM;4BACb,QAAQ,IAAA,GAAO,KAAK,IAAA;wBACtB;wBACA,IAAK,KAAa,OAAA,EAAS;4BACxB,QAAgB,OAAA,GAAW,KAAa,OAAA;wBAC3C;wBACA,IAAK,KAAa,gBAAA,EAAkB;4BACjC,QAAgB,gBAAA,GACf,KACA,gBAAA;wBACJ;wBACA,IAAI,KAAK,YAAA,EAAc;4BACrB,QAAQ,YAAA,GAAe,KAAK,YAAA;wBAC9B;wBACA,IAAI,KAAK,cAAA,EAAgB;4BACvB,QAAQ,cAAA,GAAiB,KAAK,cAAA;wBAChC;wBACA,IAAI,KAAK,mBAAA,EAAqB;4BAC5B,QAAQ,mBAAA,GAAsB,KAAK,mBAAA;wBACrC;wBACA,IAAI,OAAO,IAAA,CAAK,OAAO,EAAE,MAAA,KAAW,GAAG;4BACrC,QAAQ,IAAA,GAAO;wBACjB;wBACA,mBAAmB,UAAA,CAAW,cAAc,CAAA,CAAE,OAAA,CAAQ,KAAA,CAAM,IAAA,CAC1D;oBAEJ;gBACF;YACF;YACA;QACF;QACA,IAAI,SAAS,aAAA,EAAe;YAC1B,mBAAmB,aAAA,GAAgB,SAAS,aAAA;QAC9C;IACF;IACA,OAAO;AACT","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3132, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/predict.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getGenkitClientHeader } from './common';\n\nexport type PredictMethod = 'predict' | 'predictLongRunning';\n\nexport interface Operation {\n  name: string;\n  done?: boolean;\n  error?: {\n    message: string;\n  };\n  response?: {\n    generateVideoResponse: {\n      generatedSamples: { video: { uri: string } }[];\n    };\n  };\n}\n\nfunction predictEndpoint(options: {\n  apiVersion: string;\n  model: string;\n  apiKey: string;\n  method: PredictMethod;\n}) {\n  return `https://generativelanguage.googleapis.com/${options.apiVersion}/models/${options.model}:${options.method}?key=${options.apiKey}`;\n}\n\nfunction opCheckEndpoint(options: {\n  apiVersion: string;\n  operation: string;\n  apiKey: string;\n}) {\n  return `https://generativelanguage.googleapis.com/${options.apiVersion}/${options.operation}?key=${options.apiKey}`;\n}\n\nexport type PredictClient<I = unknown, R = unknown, P = unknown> = (\n  instances: I[],\n  parameters: P\n) => Promise<R>;\n\nexport function predictModel<I = unknown, R = unknown, P = unknown>(\n  model: string,\n  apiKey: string,\n  method: PredictMethod\n): PredictClient<I, R, P> {\n  return async (instances: I[], parameters: P): Promise<R> => {\n    const fetch = (await import('node-fetch')).default;\n\n    const req = {\n      instances,\n      parameters,\n    };\n\n    const response = await fetch(\n      predictEndpoint({\n        model,\n        apiVersion: 'v1beta',\n        apiKey,\n        method,\n      }),\n      {\n        method: 'POST',\n        body: JSON.stringify(req),\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Goog-Api-Client': getGenkitClientHeader(),\n        },\n      }\n    );\n\n    if (!response.ok) {\n      throw new Error(\n        `Error from Gemini AI predict: HTTP ${\n          response.status\n        }: ${await response.text()}`\n      );\n    }\n\n    return (await response.json()) as R;\n  };\n}\n\nexport async function checkOp(\n  operation: string,\n  apiKey: string\n): Promise<Operation> {\n  const fetch = (await import('node-fetch')).default;\n\n  const response = await fetch(\n    opCheckEndpoint({\n      apiVersion: 'v1beta',\n      operation,\n      apiKey,\n    }),\n    {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Goog-Api-Client': getGenkitClientHeader(),\n      },\n    }\n  );\n\n  if (!response.ok) {\n    throw new Error(\n      `Error from operation API: HTTP ${\n        response.status\n      }: ${await response.text()}`\n    );\n  }\n\n  return (await response.json()) as Operation;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,kBAAA,CAAA;AAAA,SAAA,iBAAA;IAAA,SAAA,IAAA;IAAA,cAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAgBA,IAAA,gBAAsC;AAiBtC,SAAS,gBAAgB,OAAA,EAKtB;IACD,OAAO,CAAA,0CAAA,EAA6C,QAAQ,UAAU,CAAA,QAAA,EAAW,QAAQ,KAAK,CAAA,CAAA,EAAI,QAAQ,MAAM,CAAA,KAAA,EAAQ,QAAQ,MAAM,EAAA;AACxI;AAEA,SAAS,gBAAgB,OAAA,EAItB;IACD,OAAO,CAAA,0CAAA,EAA6C,QAAQ,UAAU,CAAA,CAAA,EAAI,QAAQ,SAAS,CAAA,KAAA,EAAQ,QAAQ,MAAM,EAAA;AACnH;AAOO,SAAS,aACd,KAAA,EACA,MAAA,EACA,MAAA,EACwB;IACxB,OAAO,OAAO,WAAgB,eAA8B;QAC1D,MAAM,QAAA,CAAS,MAAM,OAAO,YAAY,oHAAA,EAAG,OAAA;QAE3C,MAAM,MAAM;YACV;YACA;QACF;QAEA,MAAM,WAAW,MAAM,MACrB,gBAAgB;YACd;YACA,YAAY;YACZ;YACA;QACF,CAAC,GACD;YACE,QAAQ;YACR,MAAM,KAAK,SAAA,CAAU,GAAG;YACxB,SAAS;gBACP,gBAAgB;gBAChB,qBAAA,CAAA,GAAqB,cAAA,qBAAA,EAAsB;YAC7C;QACF;QAGF,IAAI,CAAC,SAAS,EAAA,EAAI;YAChB,MAAM,IAAI,MACR,CAAA,mCAAA,EACE,SAAS,MACX,CAAA,EAAA,EAAK,MAAM,SAAS,IAAA,CAAK,CAAC,EAAA;QAE9B;QAEA,OAAQ,MAAM,SAAS,IAAA,CAAK;IAC9B;AACF;AAEA,eAAsB,QACpB,SAAA,EACA,MAAA,EACoB;IACpB,MAAM,QAAA,CAAS,MAAM,OAAO,YAAY,oHAAA,EAAG,OAAA;IAE3C,MAAM,WAAW,MAAM,MACrB,gBAAgB;QACd,YAAY;QACZ;QACA;IACF,CAAC,GACD;QACE,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,qBAAA,CAAA,GAAqB,cAAA,qBAAA,EAAsB;QAC7C;IACF;IAGF,IAAI,CAAC,SAAS,EAAA,EAAI;QAChB,MAAM,IAAI,MACR,CAAA,+BAAA,EACE,SAAS,MACX,CAAA,EAAA,EAAK,MAAM,SAAS,IAAA,CAAK,CAAC,EAAA;IAE9B;IAEA,OAAQ,MAAM,SAAS,IAAA,CAAK;AAC9B","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3232, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/imagen.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GenkitError, MessageData, z, type Genkit } from 'genkit';\nimport {\n  getBasicUsageStats,\n  modelRef,\n  type GenerateRequest,\n  type ModelAction,\n  type ModelInfo,\n  type ModelReference,\n} from 'genkit/model';\nimport { getApiKeyFromEnvVar } from './common.js';\nimport { predictModel } from './predict.js';\n\nexport type KNOWN_IMAGEN_MODELS = 'imagen-3.0-generate-002';\n\n/**\n * See https://ai.google.dev/gemini-api/docs/image-generation#imagen-model\n */\nexport const ImagenConfigSchema = z\n  .object({\n    numberOfImages: z\n      .number()\n      .describe(\n        'The number of images to generate, from 1 to 4 (inclusive). The default is 1.'\n      )\n      .optional(),\n    aspectRatio: z\n      .enum(['1:1', '9:16', '16:9', '3:4', '4:3'])\n      .describe('Desired aspect ratio of the output image.')\n      .optional(),\n    personGeneration: z\n      .enum(['dont_allow', 'allow_adult', 'allow_all'])\n      .describe(\n        'Control if/how images of people will be generated by the model.'\n      )\n      .optional(),\n  })\n  .passthrough();\n\ninterface ImagenParameters {\n  sampleCount?: number;\n  aspectRatio?: string;\n  personGeneration?: string;\n}\n\nfunction toParameters(\n  request: GenerateRequest<typeof ImagenConfigSchema>\n): ImagenParameters {\n  const out = {\n    sampleCount: request.config?.numberOfImages ?? 1,\n    ...request?.config,\n  };\n\n  for (const k in out) {\n    if (!out[k]) delete out[k];\n  }\n\n  return out;\n}\n\nfunction extractText(request: GenerateRequest) {\n  return request.messages\n    .at(-1)!\n    .content.map((c) => c.text || '')\n    .join('');\n}\n\nfunction extractBaseImage(request: GenerateRequest): string | undefined {\n  return request.messages\n    .at(-1)\n    ?.content.find((p) => !!p.media)\n    ?.media?.url.split(',')[1];\n}\n\ninterface ImagenPrediction {\n  predictions: { bytesBase64Encoded: string; mimeType: string }[];\n}\n\ninterface ImagenInstance {\n  prompt: string;\n  image?: { bytesBase64Encoded: string };\n  mask?: { image?: { bytesBase64Encoded: string } };\n}\n\nexport const GENERIC_IMAGEN_INFO = {\n  label: `Google AI - Generic Imagen`,\n  supports: {\n    media: true,\n    multiturn: false,\n    tools: false,\n    systemRole: false,\n    output: ['media'],\n  },\n} as ModelInfo;\n\nexport function defineImagenModel(\n  ai: Genkit,\n  name: string,\n  apiKey?: string | false\n): ModelAction {\n  if (apiKey !== false) {\n    apiKey = apiKey || getApiKeyFromEnvVar();\n    if (!apiKey) {\n      throw new GenkitError({\n        status: 'FAILED_PRECONDITION',\n        message:\n          'Please pass in the API key or set the GEMINI_API_KEY or GOOGLE_API_KEY environment variable.\\n' +\n          'For more details see https://genkit.dev/docs/plugins/google-genai',\n      });\n    }\n  }\n  const modelName = `googleai/${name}`;\n  const model: ModelReference<z.ZodTypeAny> = modelRef({\n    name: modelName,\n    info: {\n      ...GENERIC_IMAGEN_INFO,\n      label: `Google AI - ${name}`,\n    },\n    configSchema: ImagenConfigSchema,\n  });\n\n  return ai.defineModel(\n    {\n      name: modelName,\n      ...model.info,\n      configSchema: ImagenConfigSchema,\n    },\n    async (request) => {\n      const instance: ImagenInstance = {\n        prompt: extractText(request),\n      };\n      const baseImage = extractBaseImage(request);\n      if (baseImage) {\n        instance.image = { bytesBase64Encoded: baseImage };\n      }\n\n      const predictClient = predictModel<\n        ImagenInstance,\n        ImagenPrediction,\n        ImagenParameters\n      >(model.version || name, apiKey as string, 'predict');\n      const response = await predictClient([instance], toParameters(request));\n\n      if (!response.predictions || response.predictions.length == 0) {\n        throw new Error(\n          'Model returned no predictions. Possibly due to content filters.'\n        );\n      }\n\n      const message = {\n        role: 'model',\n        content: [],\n      } as MessageData;\n\n      response.predictions.forEach((p, i) => {\n        const b64data = p.bytesBase64Encoded;\n        const mimeType = p.mimeType;\n        message.content.push({\n          media: {\n            url: `data:${mimeType};base64,${b64data}`,\n            contentType: mimeType,\n          },\n        });\n      });\n      return {\n        finishReason: 'stop',\n        message,\n        usage: getBasicUsageStats(request.messages, message),\n        custom: response,\n      };\n    }\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3382, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/list-models.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Gemini  model definition\nexport interface Model {\n  name: string;\n  baseModelId: string;\n  version: string;\n  displayName: string;\n  description: string;\n  inputTokenLimit: number;\n  outputTokenLimit: number;\n  supportedGenerationMethods: string[];\n  temperature: number;\n  maxTemperature: number;\n  topP: number;\n  topK: number;\n}\n\n// Gemini list models response\ninterface ListModelsResponse {\n  models: Model[];\n  nextPageToken?: string;\n}\n\n/**\n * List Gemini models by making an RPC call to the API.\n *\n * https://ai.google.dev/api/models#method:-models.list\n */\nexport async function listModels(\n  baseUrl: string,\n  apiKey: string\n): Promise<Model[]> {\n  // We call the gemini list local models api:\n  const res = await fetch(\n    `${baseUrl}/v1beta/models?pageSize=1000&key=${apiKey}`,\n    {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    }\n  );\n  const modelResponse = JSON.parse(await res.text()) as ListModelsResponse;\n  return modelResponse.models;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,sBAAA,CAAA;AAAA,SAAA,qBAAA;IAAA,YAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AA2CA,eAAsB,WACpB,OAAA,EACA,MAAA,EACkB;IAElB,MAAM,MAAM,MAAM,MAChB,GAAG,OAAO,CAAA,iCAAA,EAAoC,MAAM,EAAA,EACpD;QACE,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;IACF;IAEF,MAAM,gBAAgB,KAAK,KAAA,CAAM,MAAM,IAAI,IAAA,CAAK,CAAC;IACjD,OAAO,cAAc,MAAA;AACvB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3429, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/veo.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GenerateResponseData,\n  GenkitError,\n  Operation,\n  z,\n  type Genkit,\n} from 'genkit';\nimport {\n  BackgroundModelAction,\n  modelRef,\n  type GenerateRequest,\n  type ModelInfo,\n  type ModelReference,\n} from 'genkit/model';\nimport { getApiKeyFromEnvVar } from './common.js';\nimport { Operation as ApiOperation, checkOp, predictModel } from './predict.js';\n\nexport type KNOWN_VEO_MODELS = 'veo-2.0-generate-001';\n\n/**\n * See https://ai.google.dev/gemini-api/docs/video\n */\nexport const VeoConfigSchema = z\n  .object({\n    // NOTE: Documentation notes numberOfVideos parameter to pick the number of\n    // output videos, but this setting does not seem to work\n    negativePrompt: z.string().optional(),\n    aspectRatio: z\n      .enum(['9:16', '16:9'])\n      .describe('Desired aspect ratio of the output video.')\n      .optional(),\n    personGeneration: z\n      .enum(['dont_allow', 'allow_adult', 'allow_all'])\n      .describe(\n        'Control if/how images of people will be generated by the model.'\n      )\n      .optional(),\n    durationSeconds: z\n      .number()\n      .step(1)\n      .min(5)\n      .max(8)\n      .describe('Length of each output video in seconds, between 5 and 8.')\n      .optional(),\n    enhance_prompt: z\n      .boolean()\n      .describe('Enable or disable the prompt rewriter. Enabled by default.')\n      .optional(),\n  })\n  .passthrough();\n\nfunction extractText(request: GenerateRequest) {\n  return request.messages\n    .at(-1)!\n    .content.map((c) => c.text || '')\n    .join('');\n}\n\ninterface VeoParameters {\n  sampleCount?: number;\n  aspectRatio?: string;\n  personGeneration?: string;\n}\n\nfunction toParameters(\n  request: GenerateRequest<typeof VeoConfigSchema>\n): VeoParameters {\n  const out = {\n    ...request?.config,\n  };\n\n  for (const k in out) {\n    if (!out[k]) delete out[k];\n  }\n\n  return out;\n}\n\nfunction extractImage(request: GenerateRequest): VeoImage | undefined {\n  const media = request.messages.at(-1)?.content.find((p) => !!p.media)?.media;\n  if (media) {\n    const img = media?.url.split(',')[1];\n    return {\n      bytesBase64Encoded: img,\n      mimeType: media.contentType!,\n    };\n  }\n  return undefined;\n}\n\ninterface VeoImage {\n  bytesBase64Encoded: string;\n  mimeType: string;\n}\n\ninterface VeoInstance {\n  prompt: string;\n  image?: VeoImage;\n}\n\nexport const GENERIC_VEO_INFO = {\n  label: `Google AI - Generic Veo`,\n  supports: {\n    media: true,\n    multiturn: false,\n    tools: false,\n    systemRole: false,\n    output: ['media'],\n    longRunning: true,\n  },\n} as ModelInfo;\n\nexport function defineVeoModel(\n  ai: Genkit,\n  name: string,\n  apiKey?: string | false\n): BackgroundModelAction<typeof VeoConfigSchema> {\n  if (apiKey !== false) {\n    apiKey = apiKey || getApiKeyFromEnvVar();\n    if (!apiKey) {\n      throw new GenkitError({\n        status: 'FAILED_PRECONDITION',\n        message:\n          'Please pass in the API key or set the GEMINI_API_KEY or GOOGLE_API_KEY environment variable.\\n' +\n          'For more details see https://genkit.dev/docs/plugins/google-genai',\n      });\n    }\n  }\n  const modelName = `googleai/${name}`;\n  const model: ModelReference<z.ZodTypeAny> = modelRef({\n    name: modelName,\n    info: {\n      ...GENERIC_VEO_INFO,\n      label: `Google AI - ${name}`,\n    },\n    configSchema: VeoConfigSchema,\n  });\n\n  return ai.defineBackgroundModel({\n    name: modelName,\n    ...model.info,\n    configSchema: VeoConfigSchema,\n    async start(request) {\n      const instance: VeoInstance = {\n        prompt: extractText(request),\n      };\n      const image = extractImage(request);\n      if (image) {\n        instance.image = image;\n      }\n\n      const predictClient = predictModel<\n        VeoInstance,\n        ApiOperation,\n        VeoParameters\n      >(model.version || name, apiKey as string, 'predictLongRunning');\n      const response = await predictClient([instance], toParameters(request));\n\n      return toGenkitOp(response);\n    },\n    async check(operation) {\n      const newOp = await checkOp(operation.id, apiKey as string);\n      return toGenkitOp(newOp);\n    },\n  });\n}\n\nfunction toGenkitOp(apiOp: ApiOperation): Operation<GenerateResponseData> {\n  const res = { id: apiOp.name } as Operation<GenerateResponseData>;\n  if (apiOp.done !== undefined) {\n    res.done = apiOp.done;\n  }\n\n  if (apiOp.error) {\n    res.error = { message: apiOp.error.message };\n  }\n\n  if (\n    apiOp.response &&\n    apiOp.response.generateVideoResponse &&\n    apiOp.response.generateVideoResponse.generatedSamples\n  ) {\n    res.output = {\n      finishReason: 'stop',\n      raw: apiOp.response,\n      message: {\n        role: 'model',\n        content: apiOp.response.generateVideoResponse.generatedSamples.map(\n          (s) => {\n            return {\n              media: {\n                url: s.video.uri,\n              },\n            };\n          }\n        ),\n      },\n    };\n  }\n\n  return res;\n}\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3600, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelwong/Documents/GitHub/ai-matching/node_modules/%40genkit-ai/googleai/src/index.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  embedderActionMetadata,\n  embedderRef,\n  modelActionMetadata,\n  type ActionMetadata,\n  type EmbedderReference,\n  type Genkit,\n  type ModelReference,\n  type z,\n} from 'genkit';\nimport { logger } from 'genkit/logging';\nimport { modelRef } from 'genkit/model';\nimport { genkitPlugin, type GenkitPlugin } from 'genkit/plugin';\nimport type { ActionType } from 'genkit/registry';\nimport { getApiKeyFromEnvVar } from './common.js';\nimport {\n  SUPPORTED_MODELS as EMBEDDER_MODELS,\n  GeminiEmbeddingConfigSchema,\n  defineGoogleAIEmbedder,\n  geminiEmbedding001,\n  textEmbedding004,\n  textEmbeddingGecko001,\n  type GeminiEmbeddingConfig,\n} from './embedder.js';\nimport {\n  GeminiConfigSchema,\n  SUPPORTED_GEMINI_MODELS,\n  defineGoogleAIModel,\n  gemini,\n  gemini10Pro,\n  gemini15Flash,\n  gemini15Flash8b,\n  gemini15Pro,\n  gemini20Flash,\n  gemini20FlashExp,\n  gemini20FlashLite,\n  gemini20ProExp0205,\n  gemini25FlashLite,\n  gemini25FlashPreview0417,\n  gemini25ProExp0325,\n  gemini25ProPreview0325,\n  type GeminiConfig,\n  type GeminiVersionString,\n} from './gemini.js';\nimport {\n  GENERIC_IMAGEN_INFO,\n  ImagenConfigSchema,\n  defineImagenModel,\n  type KNOWN_IMAGEN_MODELS,\n} from './imagen.js';\nimport { listModels } from './list-models.js';\nimport {\n  GENERIC_VEO_INFO,\n  KNOWN_VEO_MODELS,\n  VeoConfigSchema,\n  defineVeoModel,\n} from './veo.js';\nexport {\n  gemini,\n  gemini10Pro,\n  gemini15Flash,\n  gemini15Flash8b,\n  gemini15Pro,\n  gemini20Flash,\n  gemini20FlashExp,\n  gemini20FlashLite,\n  gemini20ProExp0205,\n  gemini25FlashLite,\n  gemini25FlashPreview0417,\n  gemini25ProExp0325,\n  gemini25ProPreview0325,\n  geminiEmbedding001,\n  textEmbedding004,\n  textEmbeddingGecko001,\n  type GeminiConfig,\n  type GeminiVersionString,\n};\n\nexport interface PluginOptions {\n  /**\n   * Provide the API key to use to authenticate with the Gemini API. By\n   * default, an API key must be provided explicitly here or through the\n   * `GEMINI_API_KEY` or `GOOGLE_API_KEY` environment variables.\n   *\n   * If `false` is explicitly passed, the plugin will be configured to\n   * expect an `apiKey` option to be provided to the model config at\n   * call time.\n   **/\n  apiKey?: string | false;\n  apiVersion?: string | string[];\n  baseUrl?: string;\n  models?: (\n    | ModelReference</** @ignore */ typeof GeminiConfigSchema>\n    | string\n  )[];\n  experimental_debugTraces?: boolean;\n}\n\nasync function initializer(ai: Genkit, options?: PluginOptions) {\n  let apiVersions = ['v1'];\n\n  if (options?.apiVersion) {\n    if (Array.isArray(options?.apiVersion)) {\n      apiVersions = options?.apiVersion;\n    } else {\n      apiVersions = [options?.apiVersion];\n    }\n  }\n\n  if (apiVersions.includes('v1beta')) {\n    Object.keys(SUPPORTED_GEMINI_MODELS).forEach((name) =>\n      defineGoogleAIModel({\n        ai,\n        name,\n        apiKey: options?.apiKey,\n        apiVersion: 'v1beta',\n        baseUrl: options?.baseUrl,\n        debugTraces: options?.experimental_debugTraces,\n      })\n    );\n  }\n  if (apiVersions.includes('v1')) {\n    Object.keys(SUPPORTED_GEMINI_MODELS).forEach((name) =>\n      defineGoogleAIModel({\n        ai,\n        name,\n        apiKey: options?.apiKey,\n        apiVersion: undefined,\n        baseUrl: options?.baseUrl,\n        debugTraces: options?.experimental_debugTraces,\n      })\n    );\n    Object.keys(EMBEDDER_MODELS).forEach((name) =>\n      defineGoogleAIEmbedder(ai, name, { apiKey: options?.apiKey })\n    );\n  }\n\n  if (options?.models) {\n    for (const modelOrRef of options?.models) {\n      const modelName =\n        typeof modelOrRef === 'string'\n          ? modelOrRef\n          : // strip out the `googleai/` prefix\n            modelOrRef.name.split('/')[1];\n      const modelRef =\n        typeof modelOrRef === 'string' ? gemini(modelOrRef) : modelOrRef;\n      defineGoogleAIModel({\n        ai,\n        name: modelName,\n        apiKey: options?.apiKey,\n        baseUrl: options?.baseUrl,\n        info: {\n          ...modelRef.info,\n          label: `Google AI - ${modelName}`,\n        },\n        debugTraces: options?.experimental_debugTraces,\n      });\n    }\n  }\n}\n\nasync function resolver(\n  ai: Genkit,\n  actionType: ActionType,\n  actionName: string,\n  options?: PluginOptions\n) {\n  if (actionType === 'embedder') {\n    resolveEmbedder(ai, actionName, options);\n  } else if (actionName.startsWith('veo')) {\n    // we do it this way because the request may come in for\n    // action type 'model' and action name 'veo-...'. That case should\n    // be a noop. It's just the order or model lookup.\n    if (actionType === 'background-model') {\n      defineVeoModel(ai, actionName, options?.apiKey);\n    }\n  } else if (actionType === 'model') {\n    resolveModel(ai, actionName, options);\n  }\n}\n\nfunction resolveModel(ai: Genkit, actionName: string, options?: PluginOptions) {\n  if (actionName.startsWith('imagen')) {\n    defineImagenModel(ai, actionName, options?.apiKey);\n    return;\n  }\n\n  const modelRef = gemini(actionName);\n  defineGoogleAIModel({\n    ai,\n    name: modelRef.name,\n    apiKey: options?.apiKey,\n    baseUrl: options?.baseUrl,\n    info: {\n      ...modelRef.info,\n      label: `Google AI - ${actionName}`,\n    },\n    debugTraces: options?.experimental_debugTraces,\n  });\n}\n\nfunction resolveEmbedder(\n  ai: Genkit,\n  actionName: string,\n  options?: PluginOptions\n) {\n  defineGoogleAIEmbedder(ai, `googleai/${actionName}`, {\n    apiKey: options?.apiKey,\n  });\n}\n\nasync function listActions(options?: PluginOptions): Promise<ActionMetadata[]> {\n  const apiKey = options?.apiKey || getApiKeyFromEnvVar();\n  if (!apiKey) {\n    // If API key is not configured we don't want to error, just return empty.\n    // In practice it will never actually reach this point without the API key,\n    // plugin initializer will fail before that.\n    logger.error(\n      'Pass in the API key or set the GEMINI_API_KEY or GOOGLE_API_KEY environment variable.'\n    );\n    return [];\n  }\n\n  const models = await listModels(\n    options?.baseUrl || 'https://generativelanguage.googleapis.com',\n    apiKey\n  );\n\n  return [\n    // Imagen\n    ...models\n      .filter(\n        (m) =>\n          m.supportedGenerationMethods.includes('predict') &&\n          m.name.includes('imagen')\n      )\n      // Filter out deprecated\n      .filter((m) => !m.description || !m.description.includes('deprecated'))\n      .map((m) => {\n        const name = m.name.split('/').at(-1)!;\n\n        return modelActionMetadata({\n          name: `googleai/${name}`,\n          info: { ...GENERIC_IMAGEN_INFO },\n          configSchema: ImagenConfigSchema,\n        });\n      }),\n    // Veo\n    ...models\n      .filter(\n        (m) =>\n          m.supportedGenerationMethods.includes('predictLongRunning') &&\n          m.name.includes('veo')\n      )\n      // Filter out deprecated\n      .filter((m) => !m.description || !m.description.includes('deprecated'))\n      .map((m) => {\n        const name = m.name.split('/').at(-1)!;\n\n        return modelActionMetadata({\n          name: `googleai/${name}`,\n          info: { ...GENERIC_VEO_INFO },\n          configSchema: VeoConfigSchema,\n          background: true,\n        });\n      }),\n    // Models\n    ...models\n      .filter((m) => m.supportedGenerationMethods.includes('generateContent'))\n      // Filter out deprecated\n      .filter((m) => !m.description || !m.description.includes('deprecated'))\n      .map((m) => {\n        const ref = gemini(\n          m.name.startsWith('models/')\n            ? m.name.substring('models/'.length)\n            : m.name\n        );\n\n        return modelActionMetadata({\n          name: ref.name,\n          info: ref.info,\n          configSchema: GeminiConfigSchema,\n        });\n      }),\n    // Embedders\n    ...models\n      .filter((m) => m.supportedGenerationMethods.includes('embedContent'))\n      // Filter out deprecated\n      .filter((m) => !m.description || !m.description.includes('deprecated'))\n      .map((m) => {\n        const name =\n          'googleai/' +\n          (m.name.startsWith('models/')\n            ? m.name.substring('models/'.length)\n            : m.name);\n\n        return embedderActionMetadata({\n          name,\n          configSchema: GeminiEmbeddingConfigSchema,\n          info: {\n            dimensions: 768,\n            label: `Google Gen AI - ${name}`,\n            supports: {\n              input: ['text'],\n            },\n          },\n        });\n      }),\n  ];\n}\n\n/**\n * Google Gemini Developer API plugin.\n */\nexport function googleAIPlugin(options?: PluginOptions): GenkitPlugin {\n  let listActionsCache;\n  return genkitPlugin(\n    'googleai',\n    async (ai: Genkit) => await initializer(ai, options),\n    async (ai: Genkit, actionType: ActionType, actionName: string) =>\n      await resolver(ai, actionType, actionName, options),\n    async () => {\n      if (listActionsCache) return listActionsCache;\n      listActionsCache = await listActions(options);\n      return listActionsCache;\n    }\n  );\n}\n\nexport type GoogleAIPlugin = {\n  (params?: PluginOptions): GenkitPlugin;\n  model(\n    name: keyof typeof SUPPORTED_GEMINI_MODELS | (`gemini-${string}` & {}),\n    config?: z.infer<typeof GeminiConfigSchema>\n  ): ModelReference<typeof GeminiConfigSchema>;\n  model(\n    name: KNOWN_IMAGEN_MODELS | (`imagen${string}` & {}),\n    config?: z.infer<typeof ImagenConfigSchema>\n  ): ModelReference<typeof ImagenConfigSchema>;\n  model(\n    name: KNOWN_VEO_MODELS | (`veo${string}` & {}),\n    config?: z.infer<typeof VeoConfigSchema>\n  ): ModelReference<typeof VeoConfigSchema>;\n  model(name: string, config?: any): ModelReference<z.ZodTypeAny>;\n  embedder(\n    name: string,\n    config?: GeminiEmbeddingConfig\n  ): EmbedderReference<typeof GeminiEmbeddingConfigSchema>;\n};\n\n/**\n * Google Gemini Developer API plugin.\n */\nexport const googleAI = googleAIPlugin as GoogleAIPlugin;\n// provide generic implementation for the model function overloads.\n(googleAI as any).model = (\n  name: string,\n  config?: any\n): ModelReference<z.ZodTypeAny> => {\n  if (name.startsWith('imagen')) {\n    return modelRef({\n      name: `googleai/${name}`,\n      config,\n      configSchema: ImagenConfigSchema,\n    });\n  }\n  if (name.startsWith('veo')) {\n    return modelRef({\n      name: `googleai/${name}`,\n      config,\n      configSchema: VeoConfigSchema,\n    });\n  }\n  return modelRef({\n    name: `googleai/${name}`,\n    config,\n    configSchema: GeminiConfigSchema,\n  });\n};\ngoogleAI.embedder = (\n  name: string,\n  config?: GeminiEmbeddingConfig\n): EmbedderReference<typeof GeminiEmbeddingConfigSchema> => {\n  return embedderRef({\n    name: `googleai/${name}`,\n    config,\n    configSchema: GeminiEmbeddingConfigSchema,\n  });\n};\n\nexport default googleAI;\n"],"names":["modelRef"],"mappings":"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","ignoreList":[0],"debugId":null}}]
}